<div class="min-h-screen bg-background">
  <!-- Header Navigation -->
  <app-header
    [navLinks]="navLinks"
    (changeInfo)="onChangeInfo()"
    (logout)="logout()"
  ></app-header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <h2 class="text-4xl font-bold text-foreground mb-8">Dashboard Fisioterapeuta</h2>

    <!-- Recent Appointments -->
    <app-card class="mb-8">
      <app-card-header className="flex items-center justify-between w-full !grid-cols-2 px-6">
        <app-card-title>Próximas 5 Citas</app-card-title>
        <button
          (click)="openResumenModal()"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors text-sm font-medium w-fit"
          title="Ver resumen del día"
        >
          <mat-icon class="text-lg">assessment</mat-icon>
          <span>Resumen</span>
        </button>
      </app-card-header>
      <app-card-content>
        <div *ngIf="proximasCitas.length > 0; else noCitas" class="space-y-4">
          <div *ngFor="let cita of proximasCitas | slice:0:5; let isFirst = first" 
            class="p-4 rounded-lg border-2 flex items-center justify-between gap-4"
            [ngClass]="getCitaColor(cita)">
            
            <!-- Contenedor izquierdo: Fecha, Hora y Paciente -->
            <div class="flex-1 min-w-0">
              <!-- Fecha si no es hoy -->
              <div *ngIf="!isHoyCita(cita.fecha)" class="mb-2">
                <span class="text-xs font-semibold text-primary bg-primary/10 px-2 py-1 rounded-full">
                  {{ formatFecha(cita.fecha) }}
                </span>
              </div>

              <!-- Hora y Paciente -->
              <div class="flex items-center gap-3 mb-2">
                <div class="flex-shrink-0 w-16 font-bold text-lg text-foreground">
                  {{ cita.hora }}
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <mat-icon class="text-foreground text-base flex-shrink-0">person</mat-icon>
                    <h4 class="font-semibold text-foreground truncate">{{ cita.nombrePaciente }}</h4>
                  </div>
                <p class="text-xs text-muted-foreground truncate">{{ cita.tipo || 'Sin tipo' }}</p>
                </div>
              </div>
              
              <!-- Teléfono -->
              <div class="flex items-center gap-2 ml-19 text-xs text-foreground">
                <mat-icon class="text-muted-foreground text-sm flex-shrink-0">phone</mat-icon>
                <p class="truncate">{{ cita.telefonoPaciente || 'Sin teléfono' }}</p>
              </div>
            </div>
            
            <!-- Doble Semáforo de Estados (Compacto) -->
            <div class="flex items-center gap-3 flex-shrink-0">
              <!-- Semáforo Fisio -->
              <div class="flex items-center gap-1 px-2 py-1 rounded bg-white/50">
                <div class="w-3 h-3 rounded-full flex-shrink-0" [ngClass]="getColorFisio(cita.estadoFisio)"></div>
                <p class="text-xs font-semibold text-muted-foreground whitespace-nowrap">{{ cita.estadoFisio }}</p>
              </div>
              
              <!-- Semáforo Paciente -->
              <div class="flex items-center gap-1 px-2 py-1 rounded bg-white/50">
                <div class="w-3 h-3 rounded-full flex-shrink-0" [ngClass]="getColorPaciente(cita.estadoPaciente)"></div>
                <p class="text-xs font-semibold text-muted-foreground whitespace-nowrap">{{ cita.estadoPaciente }}</p>
              </div>
            </div>
          </div>

          <!-- Mensaje si hay más citas -->
          <div *ngIf="proximasCitas.length > 5" class="text-center text-xs text-muted-foreground pt-2">
            +{{ proximasCitas.length - 5 }} citas más. <a routerLink="/fisioterapeuta/agenda" class="text-primary font-medium hover:underline">Ver agenda completa</a>
          </div>
        </div>
        <ng-template #noCitas>
          <p class="text-muted-foreground text-center py-4">No hay citas próximas programadas</p>
        </ng-template>
      </app-card-content>
    </app-card>
    <!-- Pacientes Section -->
    <app-card class="mb-8">
      <app-card-header>
        <app-card-title>Mis Pacientes</app-card-title>
      </app-card-header>
      <app-card-content>
        <div *ngIf="pacientesVinculados.length > 0; else noPacientes" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div *ngFor="let paciente of pacientesVinculados" 
            class="p-4 rounded-lg border-2 border-border hover:border-primary transition-all cursor-pointer"
            (click)="navigateToPaciente(paciente.id)">
            
            <div class="flex items-start gap-3 mb-3">
              <!-- Avatar con iniciales -->
              <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                <span class="text-lg font-semibold text-primary">
                  {{ getInitials(paciente.nombre) }}
                </span>
              </div>
              
              <div class="flex-1 min-w-0">
                <h4 class="font-semibold text-foreground mb-1">{{ paciente.nombre }}</h4>
                <p class="text-sm text-muted-foreground">{{ calculateAge(paciente.fechaNacimiento) }} años</p>
              </div>
            </div>
            
            <!-- Información de contacto -->
            <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
              <div class="flex items-center gap-1 text-muted-foreground">
                <mat-icon class="text-base">phone</mat-icon>
                <span class="truncate">{{ paciente.telefono || 'Sin teléfono' }}</span>
              </div>
              <div class="flex items-center gap-1 text-muted-foreground">
                <mat-icon class="text-base">email</mat-icon>
                <span class="truncate">{{ paciente.email }}</span>
              </div>
            </div>
            
            <!-- Barra de Progreso -->
            <div *ngIf="paciente.tieneProgramaActivo" class="mt-3 space-y-2">
              <div class="flex items-center justify-between text-xs">
                <span class="text-muted-foreground">Progreso</span>
                <span class="font-medium text-foreground">
                  {{ paciente.diasCompletados }}/{{ paciente.diasTotales }} días ({{ paciente.porcentajeProgreso }}%)
                </span>
              </div>
              <div class="w-full bg-muted rounded-full h-2 overflow-hidden">
                <div
                  class="bg-primary h-full transition-all duration-300"
                  [style.width.%]="paciente.porcentajeProgreso"
                ></div>
              </div>
            </div>
            <div *ngIf="!paciente.tieneProgramaActivo" class="mt-3">
              <div class="flex items-center gap-1 text-xs text-muted-foreground">
                <mat-icon class="text-sm">info</mat-icon>
                <span>Sin programa activo</span>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noPacientes>
          <p class="text-muted-foreground text-center py-4">No hay pacientes vinculados</p>
        </ng-template>
      </app-card-content>
    </app-card>



  </main>
</div>
