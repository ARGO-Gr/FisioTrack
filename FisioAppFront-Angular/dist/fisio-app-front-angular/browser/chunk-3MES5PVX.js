import{a as X}from"./chunk-3SOA4LHR.js";import{a as Z}from"./chunk-JFACI4Q3.js";import{a as N}from"./chunk-T3SLRWRV.js";import{a as Y}from"./chunk-S2THENYC.js";import{a as R}from"./chunk-X3IRCCKU.js";import{a as W}from"./chunk-CJ3OBUWM.js";import{b as O,c as B,d as H,e as U,f as z}from"./chunk-AXJP532N.js";import{c as K,j as Q}from"./chunk-B6JTRMRK.js";import{a as j}from"./chunk-RWZ5TKRV.js";import"./chunk-MIONVMI7.js";import{c as J}from"./chunk-BV64I7NB.js";import"./chunk-Y2M3SQ4J.js";import{Ba as i,Bb as L,C as g,Ca as n,Da as h,Ha as C,Ja as _,Ka as u,Lb as V,Mb as $,P as f,Q as x,Sa as I,Ta as a,Ua as l,Va as D,Wa as A,da as r,g as y,ha as p,hb as T,la as w,pa as b,pc as G,qc as q,ta as m,tb as k,ua as E,ub as F,vb as M}from"./chunk-OSJLVL2X.js";function ae(d,t){if(d&1&&(i(0,"app-card",6)(1,"app-card-header")(2,"app-card-title"),a(3,"Mi Programa de Rehabilitaci\xF3n"),n(),i(4,"app-card-description"),a(5),n()(),i(6,"app-card-content")(7,"div",10)(8,"div")(9,"div",11)(10,"span",12),a(11,"Progreso General"),n(),i(12,"span",13),a(13),n()(),i(14,"div",14),h(15,"div",15),n()(),i(16,"div",16)(17,"div",17)(18,"div",18)(19,"mat-icon",19),a(20,"check_circle"),n()(),i(21,"div")(22,"p",20),a(23,"D\xEDas Completados"),n(),i(24,"p",21),a(25),n()()(),i(26,"div",22)(27,"div",23)(28,"mat-icon",24),a(29,"pending"),n()(),i(30,"div")(31,"p",20),a(32,"D\xEDas Pendientes"),n(),i(33,"p",21),a(34),n()()(),i(35,"div",25)(36,"div",26)(37,"mat-icon",27),a(38,"calendar_month"),n()(),i(39,"div")(40,"p",20),a(41,"Semana"),n(),i(42,"p",21),a(43),n()()()(),i(44,"a",28)(45,"app-button",29)(46,"mat-icon",30),a(47,"fitness_center"),n(),a(48," Ver Mi Rutina Completa "),n()()()()()),d&2){let e=u();r(5),l(e.resumenPrograma.nombre),r(8),D("",e.resumenPrograma.progreso,"%"),r(2),E("width",e.resumenPrograma.progreso,"%"),r(10),l(e.resumenPrograma.diasCompletados),r(9),l(e.resumenPrograma.diasTotales-e.resumenPrograma.diasCompletados),r(9),A("",e.resumenPrograma.semanaActual," / ",e.resumenPrograma.totalSemanas,"")}}function oe(d,t){if(d&1){let e=C();i(0,"button",48),_("click",function(){f(e);let s=u().$implicit,c=u(2);return x(c.openConfirmModal(s))}),i(1,"mat-icon",43),a(2,"check_circle"),n(),a(3," Confirmar "),n()}}function re(d,t){if(d&1){let e=C();i(0,"button",49),_("click",function(){f(e);let s=u().$implicit,c=u(2);return x(c.openCancelConfirm(s))}),i(1,"mat-icon",43),a(2,"cancel"),n(),a(3," Cancelar "),n()}}function se(d,t){if(d&1&&(i(0,"div",33)(1,"div",34)(2,"div",35)(3,"h3",36),a(4),n(),i(5,"p",37),a(6),n()(),i(7,"div",38),b(8,oe,4,0,"button",39)(9,re,4,0,"button",40),n()(),i(10,"div",41)(11,"div",42)(12,"mat-icon",43),a(13,"calendar_today"),n(),i(14,"span"),a(15),n()(),i(16,"div",42)(17,"mat-icon",43),a(18,"schedule"),n(),i(19,"span"),a(20),n()()(),i(21,"div",44)(22,"div",38)(23,"p",45),a(24,"Fisio:"),n(),i(25,"div",42),h(26,"div",46),i(27,"p",47),a(28),n()()(),i(29,"div",38)(30,"p",45),a(31,"Paciente:"),n(),i(32,"div",42),h(33,"div",46),i(34,"p",47),a(35),n()()()()()),d&2){let e=t.$implicit,o=u(2);m("ngClass",o.getCitaColor(e)),r(4),l(e.descripcion||"Cita de fisioterapia"),r(2),l(e.tipo),r(2),m("ngIf",o.puedeConfirmar(e)),r(),m("ngIf",o.puedeCancelar(e)),r(6),l(o.formatDate(e.fecha)),r(5),l(e.hora),r(6),m("ngClass",o.getColorFisio(e.estadoFisio)),r(2),l(e.estadoFisio),r(5),m("ngClass",o.getColorPaciente(e.estadoPaciente)),r(2),l(e.estadoPaciente)}}function de(d,t){if(d&1&&(i(0,"div",31),b(1,se,36,11,"div",32),n()),d&2){let e=u();r(),m("ngForOf",e.citasProximas)}}function ce(d,t){d&1&&(i(0,"p",50),a(1,"No tienes citas pr\xF3ximas programadas"),n())}var ee=class d{constructor(t,e,o,s,c,v,S){this.db=t;this.authService=e;this.router=o;this.appointmentService=s;this.toastService=c;this.dialog=v;this.programaService=S}navLinks=[{label:"Dashboard",route:"/paciente/dashboard"},{label:"Mi Rutina",route:"/paciente/rutinas"},{label:"Mis Citas",route:"/paciente/citas"},{label:"Pagos",route:"/paciente/pagos-pendientes"}];rutinas=[];citasProximas=[];loading=!0;pacienteId="";programaActivo=null;resumenPrograma={nombre:"",diasCompletados:0,diasTotales:0,progreso:0,semanaActual:1,totalSemanas:1};destroy$=new y;ngOnInit(){let t=this.authService.getUserId();t&&(this.pacienteId=t,this.db.getRutinasByPaciente("1").subscribe(e=>{this.rutinas=e,this.loading=!1}),this.cargarCitasProximas(),this.cargarProgramaActivo())}cargarCitasProximas(){this.appointmentService.getAppointmentsByPatient(this.pacienteId).pipe(g(this.destroy$)).subscribe({next:t=>{let e=new Date;e.setHours(0,0,0,0),this.citasProximas=t.filter(o=>{let s=o.estadoFisio?.toLowerCase()||"",c=o.estadoPaciente?.toLowerCase()||"",[v,S,te]=o.fecha.split("-").map(Number),P=new Date(v,S-1,te);P.setHours(0,0,0,0);let ie=P>=e,ne=!s.includes("cancelada")&&!c.includes("cancelada");return ie&&ne&&((s==="pendiente"||s==="confirmadofisio")&&(c==="pendiente"||c==="confirmadopaciente"))}).sort((o,s)=>{let c=new Date(`${o.fecha}T${o.hora}`),v=new Date(`${s.fecha}T${s.hora}`);return c.getTime()-v.getTime()}).slice(0,3)},error:t=>{console.error("Error cargando citas:",t)}})}cargarProgramaActivo(){this.programaService.obtenerProgramaActivoPaciente().pipe(g(this.destroy$)).subscribe({next:t=>{this.programaActivo=t,this.resumenPrograma={nombre:t.nombre,diasCompletados:t.diasCompletados,diasTotales:t.diasTotales,progreso:t.diasTotales>0?Math.round(t.diasCompletados/t.diasTotales*100):0,semanaActual:t.semanaActual,totalSemanas:t.totalSemanas}},error:t=>{console.error("Error cargando programa:",t)}})}getCitaColor(t){let e=t.estadoFisio?.toLowerCase(),o=t.estadoPaciente?.toLowerCase();return e==="confirmadofisio"&&o==="confirmadopaciente"?"border-l-4 border-l-blue-500 bg-blue-50":"border-l-4 border-l-yellow-500 bg-yellow-50"}getEstadoText(t){let e=t.estadoFisio?.toLowerCase(),o=t.estadoPaciente?.toLowerCase();return e==="confirmadofisio"&&o==="confirmadopaciente"?"Confirmada":"Pendiente"}formatDate(t){let[e,o,s]=t.split("-").map(Number);return new Date(e,o-1,s).toLocaleDateString("es-ES",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}getColorFisio(t){switch(t?.toLowerCase()){case"pendiente":return"bg-yellow-400";case"confirmadofisio":return"bg-blue-400";case"cobrado":return"bg-green-400";case"cobropendiente":return"bg-orange-400";case"canceladafisio":return"bg-red-400";default:return"bg-gray-400"}}getColorPaciente(t){switch(t?.toLowerCase()){case"pendiente":return"bg-yellow-400";case"confirmadopaciente":return"bg-blue-400";case"canceladapaciente":return"bg-orange-400";default:return"bg-gray-400"}}puedeConfirmar(t){let e=t.estadoFisio?.toLowerCase(),o=t.estadoPaciente?.toLowerCase();return e!=="canceladafisio"&&e!=="cobrado"&&e!=="cobropendiente"&&o!=="confirmadopaciente"}puedeCancelar(t){let e=t.estadoFisio?.toLowerCase(),o=t.estadoPaciente?.toLowerCase();return e!=="canceladafisio"&&e!=="cobrado"&&e!=="cobropendiente"&&o!=="canceladapaciente"}openConfirmModal(t){this.appointmentService.changeAppointmentStatusPaciente(t.id,"ConfirmadoPaciente").pipe(g(this.destroy$)).subscribe({next:()=>{this.toastService.success("Cita confirmada exitosamente"),this.cargarCitasProximas()},error:e=>{this.toastService.error("Error al confirmar la cita"),console.error("Error:",e)}})}openCancelConfirm(t){this.dialog.open(Z,{width:"400px",data:{paciente:"tu",fecha:new Date(t.fecha),hora:t.hora}}).afterClosed().subscribe(o=>{o&&this.appointmentService.changeAppointmentStatusPaciente(t.id,"CanceladaPaciente").pipe(g(this.destroy$)).subscribe({next:()=>{this.toastService.success("Cita cancelada exitosamente"),this.cargarCitasProximas()},error:s=>{this.toastService.error("Error al cancelar la cita"),console.error("Error:",s)}})})}onChangeInfo(){console.log("Cambiar informaci\xF3n - pendiente de implementar")}logout(){this.authService.logout()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||d)(p(X),p(j),p(V),p(W),p(R),p(J),p(Y))};static \u0275cmp=w({type:d,selectors:[["app-paciente-dashboard"]],decls:19,vars:4,consts:[["noCitas",""],[1,"min-h-screen","bg-background"],[3,"changeInfo","logout","navLinks"],[1,"container","mx-auto","px-4","py-8"],[1,"text-4xl","font-bold","text-foreground","mb-8"],["class","mb-8",4,"ngIf"],[1,"mb-8"],["class","space-y-3",4,"ngIf","ngIfElse"],["routerLink","/paciente/citas",1,"mt-4","inline-block"],["size","sm"],[1,"space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-foreground"],[1,"text-sm","font-bold","text-primary"],[1,"w-full","bg-muted","rounded-full","h-3"],[1,"bg-primary","h-3","rounded-full","transition-all","duration-300"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mt-6"],[1,"flex","items-center","gap-3","p-3","rounded-lg","bg-green-50","border","border-green-200"],[1,"w-10","h-10","rounded-lg","bg-green-100","flex","items-center","justify-center","flex-shrink-0"],[1,"text-green-600"],[1,"text-xs","text-muted-foreground"],[1,"text-lg","font-bold","text-foreground"],[1,"flex","items-center","gap-3","p-3","rounded-lg","bg-yellow-50","border","border-yellow-200"],[1,"w-10","h-10","rounded-lg","bg-yellow-100","flex","items-center","justify-center","flex-shrink-0"],[1,"text-yellow-600"],[1,"flex","items-center","gap-3","p-3","rounded-lg","bg-blue-50","border","border-blue-200"],[1,"w-10","h-10","rounded-lg","bg-blue-100","flex","items-center","justify-center","flex-shrink-0"],[1,"text-blue-600"],["routerLink","/paciente/rutinas",1,"mt-4","inline-block","w-full"],["size","default",1,"w-full"],[1,"mr-2"],[1,"space-y-3"],["class","p-4 rounded-lg border-l-4",3,"ngClass",4,"ngFor","ngForOf"],[1,"p-4","rounded-lg","border-l-4",3,"ngClass"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1"],[1,"font-semibold","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"flex","items-center","gap-2"],["class","flex items-center gap-1 px-3 py-1.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors text-sm font-medium",3,"click",4,"ngIf"],["class","flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white border-2 border-red-600 text-red-600 hover:bg-red-50 transition-colors text-sm font-medium",3,"click",4,"ngIf"],[1,"flex","items-center","gap-4","text-sm","text-muted-foreground","mb-3"],[1,"flex","items-center","gap-1"],[1,"text-sm"],[1,"flex","items-center","gap-6","pt-2","border-t","border-border"],[1,"text-xs","font-semibold","text-muted-foreground"],[1,"w-4","h-4","rounded-full",3,"ngClass"],[1,"text-xs","text-foreground"],[1,"flex","items-center","gap-1","px-3","py-1.5","rounded-lg","bg-blue-600","text-white","hover:bg-blue-700","transition-colors","text-sm","font-medium",3,"click"],[1,"flex","items-center","gap-1","px-3","py-1.5","rounded-lg","bg-white","border-2","border-red-600","text-red-600","hover:bg-red-50","transition-colors","text-sm","font-medium",3,"click"],[1,"text-muted-foreground","text-center","py-4"]],template:function(e,o){if(e&1){let s=C();i(0,"div",1)(1,"app-header",2),_("changeInfo",function(){return f(s),x(o.onChangeInfo())})("logout",function(){return f(s),x(o.logout())}),n(),i(2,"main",3)(3,"h2",4),a(4,"Bienvenido, Paciente"),n(),b(5,ae,49,8,"app-card",5),i(6,"app-card",6)(7,"app-card-header")(8,"app-card-title"),a(9,"Mis Citas Pr\xF3ximas"),n(),i(10,"app-card-description"),a(11,"Tus pr\xF3ximas citas programadas"),n()(),i(12,"app-card-content"),b(13,de,2,1,"div",7)(14,ce,2,0,"ng-template",null,0,T),i(16,"a",8)(17,"app-button",9),a(18,"Ver Todas las Citas"),n()()()()()()}if(e&2){let s=I(15);r(),m("navLinks",o.navLinks),r(4),m("ngIf",o.programaActivo),r(8),m("ngIf",o.citasProximas.length>0)("ngIfElse",s)}},dependencies:[L,k,F,M,$,O,B,H,U,z,N,q,G,K,Q],encapsulation:2})};export{ee as PacienteDashboardComponent};
