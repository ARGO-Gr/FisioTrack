import{a as nt,b as rt,c as ot}from"./chunk-GVGIFRN3.js";import{a as oe}from"./chunk-S2THENYC.js";import{a as at}from"./chunk-YX3Y33SO.js";import{a as $}from"./chunk-X3IRCCKU.js";import{b as X,c as ye,d as ee,e as qe,f as Je,g as Qe,i as Ke,j as Ze,r as Xe,s as te,t as et}from"./chunk-BKO5ELJN.js";import{a as N}from"./chunk-CJ3OBUWM.js";import{b as L,c as ie,d as ne,f as W}from"./chunk-AXJP532N.js";import{j as it}from"./chunk-B6JTRMRK.js";import{a as He}from"./chunk-RWZ5TKRV.js";import"./chunk-MIONVMI7.js";import{a as k,b as F,c as re,e as A}from"./chunk-BV64I7NB.js";import"./chunk-Y2M3SQ4J.js";import{$ as Ee,$a as Ve,Ba as t,Bb as w,C as _,Ca as i,Da as x,Ea as G,Fa as z,Ga as Q,Gb as Be,H as Pe,Ha as D,I as De,Ja as u,Jb as Ge,K as S,Ka as m,Lb as ze,Ob as Ye,P as v,Pa as Te,Pb as Ue,Q as h,Qa as ke,R as he,Ra as Fe,S as Me,Sa as Y,Ta as o,Ua as p,Va as b,Wa as Ne,Xa as K,Y as we,Ya as Oe,Za as Re,_a as je,a as xe,b as ve,bb as $e,da as l,db as _e,fb as be,g as P,ha as f,hb as U,k as Se,la as C,ma as Ie,mb as Z,oc as tt,pa as g,pc as E,qc as I,sa as O,ta as d,tb as V,u as Ce,ua as R,ub as T,va as Ae,vb as M,wa as j,wb as Le,yb as We}from"./chunk-OSJLVL2X.js";function ut(a,n){a&1&&(t(0,"div",6)(1,"div",7)(2,"div",8)(3,"mat-icon",9),o(4,"refresh"),i()(),t(5,"p",10),o(6,"Cargando progreso del paciente..."),i()()())}function ft(a,n){a&1&&(t(0,"div",6)(1,"app-card",11)(2,"app-card-content",12)(3,"mat-icon",13),o(4,"inbox"),i(),t(5,"h3",14),o(6,"Sin programa activo"),i(),t(7,"p",10),o(8,"Este paciente no tiene un programa de rehabilitaci\xF3n activo."),i()()()())}function xt(a,n){a&1&&(t(0,"mat-icon",59),o(1,"check_circle"),i())}function vt(a,n){a&1&&(t(0,"mat-icon",60),o(1,"cancel"),i())}function ht(a,n){if(a&1&&(t(0,"div",55)(1,"div")(2,"span",56),o(3),i(),g(4,xt,2,0,"mat-icon",57)(5,vt,2,0,"mat-icon",58),i()()),a&2){let e=m().$implicit,r=m(3);d("ngClass",r.getDayStatus(e)),l(),j("w-full h-16 rounded-lg border-2 flex flex-col items-center justify-center transition-all cursor-pointer "+(r.getDayStatus(e)==="completed"?"bg-green-100 border-green-500":"")+(r.getDayStatus(e)==="rest"?"bg-blue-100 border-blue-500":"")+(r.getDayStatus(e)==="incumplido"?"bg-red-100 border-red-500":"")+(r.getDayStatus(e)==="pending"?"bg-orange-50 border-orange-400 hover:border-orange-600":"")+(r.getDayStatus(e)==="empty"?"bg-gray-50 border-gray-300":"")),l(2),p(e.getDate()),l(),d("ngIf",r.getDayStatus(e)==="completed"),l(),d("ngIf",r.getDayStatus(e)==="incumplido")}}function _t(a,n){if(a&1&&(G(0),g(1,ht,6,6,"div",54),z()),a&2){let e=n.$implicit;l(),d("ngIf",e)}}function bt(a,n){if(a&1){let e=D();t(0,"app-card")(1,"app-card-header")(2,"div",15)(3,"div")(4,"app-card-title",16),o(5),i(),t(6,"p",10),o(7),_e(8,"date"),_e(9,"date"),i()(),t(10,"div",17)(11,"p",18),o(12),i(),t(13,"p",19),o(14,"Completado"),i()()()(),t(15,"app-card-content",20)(16,"div",21)(17,"div",22)(18,"div",23)(19,"mat-icon",24),o(20,"check_circle"),i(),t(21,"div")(22,"p",25),o(23,"D\xEDas Completados"),i(),t(24,"p",26),o(25),i()()()(),t(26,"div",27)(27,"div",23)(28,"mat-icon",28),o(29,"hotel"),i(),t(30,"div")(31,"p",29),o(32,"D\xEDas de Descanso"),i(),t(33,"p",30),o(34),i()()()(),t(35,"div",31)(36,"div",23)(37,"mat-icon",32),o(38,"cancel"),i(),t(39,"div")(40,"p",33),o(41,"D\xEDas Incumplidos"),i(),t(42,"p",34),o(43),i()()()(),t(44,"div",35)(45,"div",23)(46,"mat-icon",36),o(47,"pending_actions"),i(),t(48,"div")(49,"p",37),o(50,"D\xEDas Pendientes"),i(),t(51,"p",38),o(52),i()()()()(),t(53,"div")(54,"div",39)(55,"button",40),u("click",function(){v(e);let s=m(2);return h(s.previousMonth())}),t(56,"mat-icon"),o(57,"chevron_left"),i()(),t(58,"h3",41),o(59),i(),t(60,"button",40),u("click",function(){v(e);let s=m(2);return h(s.nextMonth())}),t(61,"mat-icon"),o(62,"chevron_right"),i()()(),t(63,"div",42)(64,"div",43),o(65,"Lun"),i(),t(66,"div",43),o(67,"Mar"),i(),t(68,"div",43),o(69,"Mi\xE9"),i(),t(70,"div",43),o(71,"Jue"),i(),t(72,"div",43),o(73,"Vie"),i(),t(74,"div",43),o(75,"Sab"),i(),t(76,"div",43),o(77,"Dom"),i()(),t(78,"div",44),g(79,_t,2,1,"ng-container",45),i(),t(80,"div",46)(81,"p",47),o(82,"Leyenda"),i(),t(83,"div",48)(84,"div",49),x(85,"div",50),t(86,"span",19),o(87,"Completado"),i()(),t(88,"div",49),x(89,"div",51),t(90,"span",19),o(91,"Descanso"),i()(),t(92,"div",49),x(93,"div",52),t(94,"span",19),o(95,"Incumplido"),i()(),t(96,"div",49),x(97,"div",53),t(98,"span",19),o(99,"Pendiente"),i()()()()()()()}if(a&2){let e=m(2);l(5),b("Progreso de ",e.patientData.nombre,""),l(2),Ne(" Per\xEDodo: ",be(8,10,e.patientData.programStartDate,"dd/MM/yyyy")," - ",be(9,13,e.patientData.programEndDate,"dd/MM/yyyy")," "),l(5),b("",e.getCompletionPercentage(),"%"),l(13),p(e.programaActivo.diasCompletados||0),l(9),p(e.patientData.restDays.length),l(9),p(e.patientData.incumplimientoDays.length),l(9),p(e.getDiasPendientes()),l(7),p(e.getMonthYear()),l(20),d("ngForOf",e.calendarDays)}}function yt(a,n){if(a&1&&(t(0,"div"),g(1,bt,100,16,"app-card",5),i()),a&2){let e=m();l(),d("ngIf",e.patientData)}}var ae=class a{constructor(n,e,r){this.data=n;this.dialogRef=e;this.programaService=r}patientData=null;calendarDays=[];currentMonth=new Date;loading=!0;programaActivo=null;destroy$=new P;ngOnInit(){this.loadPatientProgress(this.data.pacienteId)}loadPatientProgress(n){this.loading=!0,this.programaService.obtenerProgramasPorPaciente(n).pipe(_(this.destroy$)).subscribe({next:e=>{let r=e.find(s=>s.activo);r?(this.programaActivo=r,this.mapearProgramaACalendario(r)):this.loading=!1},error:e=>{console.error("Error al cargar progreso:",e),this.loading=!1}})}mapearProgramaACalendario(n){let e=[],r=[],s=[],c=[],y=new Date(n.fechaInicio);n.semanas.forEach((B,ct)=>{B.dias.forEach((q,mt)=>{let pt=ct*7+mt,fe=new Date(y);fe.setDate(fe.getDate()+pt);let J=fe.toISOString().split("T")[0];q.tipo==="descanso"?r.push(J):q.incumplido?s.push(J):q.completado?e.push(J):q.tipo==="rutina"&&c.push(J)})}),this.patientData={pacienteId:n.pacienteId,nombre:this.data.nombrePaciente,programStartDate:n.fechaInicio.split("T")[0],programEndDate:n.fechaFin.split("T")[0],completedDays:e,restDays:r,incumplimientoDays:s,pendingDays:c,appointments:[]},this.generateCalendar(),this.loading=!1}generateCalendar(){this.calendarDays=[];let n=this.currentMonth.getFullYear(),e=this.currentMonth.getMonth(),r=new Date(n,e,1),s=new Date(n,e+1,0),c=new Date(r);c.setDate(c.getDate()-r.getDay());for(let y=0;y<42;y++){y>0&&c.setDate(c.getDate()+1);let B=new Date(c);B.getMonth()===e?this.calendarDays.push(new Date(B)):this.calendarDays.push(null)}}getDayStatus(n){if(!n||!this.patientData)return"";let e=n.toISOString().split("T")[0];return this.patientData.completedDays.includes(e)?"completed":this.patientData.restDays.includes(e)?"rest":this.patientData.incumplimientoDays.includes(e)?"incumplido":this.patientData.pendingDays.includes(e)?"pending":"empty"}previousMonth(){this.currentMonth=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()-1),this.generateCalendar()}nextMonth(){this.currentMonth=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+1),this.generateCalendar()}getMonthYear(){return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][this.currentMonth.getMonth()]} ${this.currentMonth.getFullYear()}`}getCompletionPercentage(){if(!this.programaActivo)return 0;let n=this.programaActivo.diasTotales,e=this.programaActivo.diasCompletados;return n>0?Math.round(e/n*100):0}getDiasPendientes(){return this.programaActivo?this.programaActivo.diasTotales-this.programaActivo.diasCompletados:0}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(f(F),f(k),f(oe))};static \u0275cmp=C({type:a,selectors:[["app-patient-progress-modal"]],decls:10,vars:3,consts:[[1,"max-h-[calc(100vh-3rem)]","overflow-y-auto","p-6","m-4"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold"],["mat-icon-button","",1,"text-muted-foreground","hover:text-foreground",3,"click"],["class","flex items-center justify-center py-12",4,"ngIf"],[4,"ngIf"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center"],[1,"animate-spin","mb-4","mx-auto"],[1,"text-primary","text-"],[1,"text-muted-foreground"],[1,"max-w-md","w-full"],[1,"p-12","text-center"],[1,"text-muted-foreground","mx-auto","mb-4","opacity-50"],[1,"text-xl","font-semibold","mb-2"],[1,"flex","items-center","justify-between"],[1,"text-3xl","mb-2"],[1,"text-right"],[1,"text-4xl","font-bold","text-primary"],[1,"text-sm","text-muted-foreground"],[1,""],[1,"grid","grid-cols-4","gap-4"],[1,"p-4","rounded-lg","bg-green-50","border-2","border-green-500"],[1,"flex","items-center","gap-3"],[1,"text-green-600"],[1,"text-sm","text-green-700"],[1,"text-2xl","font-bold","text-green-800"],[1,"p-4","rounded-lg","bg-blue-50","border-2","border-blue-500"],[1,"text-blue-600"],[1,"text-sm","text-blue-700"],[1,"text-2xl","font-bold","text-blue-800"],[1,"p-4","rounded-lg","bg-red-50","border-2","border-red-500"],[1,"text-red-600"],[1,"text-sm","text-red-700"],[1,"text-2xl","font-bold","text-red-800"],[1,"p-4","rounded-lg","bg-orange-50","border-2","border-orange-500"],[1,"text-orange-600"],[1,"text-sm","text-orange-700"],[1,"text-2xl","font-bold","text-orange-800"],[1,"flex","items-center","justify-between","mt-6"],[1,"p-2","hover:bg-muted","rounded-lg","transition-colors",3,"click"],[1,"text-xl","font-semibold","text-foreground"],[1,"grid","grid-cols-7","gap-2","mb-2"],[1,"text-center","font-semibold","text-sm","text-muted-foreground","p-2"],[1,"grid","grid-cols-7","gap-2"],[4,"ngFor","ngForOf"],[1,"p-4","rounded-lg","bg-muted/20","border","border-border","mt-5"],[1,"text-sm","font-semibold","text-foreground","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-3"],[1,"flex","items-center","gap-2"],[1,"w-4","h-4","rounded","bg-green-100","border-2","border-green-500"],[1,"w-4","h-4","rounded","bg-blue-100","border-2","border-blue-500"],[1,"w-4","h-4","rounded","bg-red-100","border-2","border-red-500"],[1,"w-4","h-4","rounded","bg-orange-50","border-2","border-orange-400"],["class","day-cell",3,"ngClass",4,"ngIf"],[1,"day-cell",3,"ngClass"],[1,"text-sm","font-semibold","text-foreground"],["class","text-green-600 text-xs",4,"ngIf"],["class","text-red-600 text-xs",4,"ngIf"],[1,"text-green-600","text-xs"],[1,"text-red-600","text-xs"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"Progreso del Paciente"),i(),t(4,"button",3),u("click",function(){return r.dialogRef.close()}),t(5,"mat-icon"),o(6,"close"),i()()(),g(7,ut,7,0,"div",4)(8,ft,9,0,"div",4)(9,yt,2,1,"div",5),i()),e&2&&(l(7),d("ngIf",r.loading),l(),d("ngIf",!r.loading&&!r.programaActivo),l(),d("ngIf",!r.loading&&r.programaActivo))},dependencies:[w,V,T,M,We,A,I,E,L,ie,ne,W],styles:["@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.day-cell[_ngcontent-%COMP%]{min-height:64px}[_nghost-%COMP%]     .mat-mdc-dialog-container{overflow:visible!important}[_nghost-%COMP%]     .mdc-dialog__content{padding:0!important;overflow:visible!important}"]})};function Ct(a,n){a&1&&(t(0,"div",6)(1,"div",7)(2,"div",8)(3,"mat-icon",9),o(4,"refresh"),i()(),t(5,"p",10),o(6,"Cargando citas del paciente..."),i()()())}function Pt(a,n){a&1&&(t(0,"div",6)(1,"app-card",11)(2,"app-card-content",12)(3,"mat-icon",13),o(4,"event"),i(),t(5,"h3",14),o(6,"Sin citas"),i(),t(7,"p",10),o(8,"Este paciente no tiene citas registradas."),i()()()())}function Dt(a,n){if(a&1&&(G(0),x(1,"div",63),z()),a&2){let e=n.$implicit,r=m(4);l(),j("w-2 h-2 rounded-full transition-transform hover:scale-150 cursor-pointer "+(r.getAppointmentStatus(e)==="completed"?"bg-green-500":"")+(r.getAppointmentStatus(e)==="pending-payment"?"bg-orange-500":"")+(r.getAppointmentStatus(e)==="confirmed"?"bg-blue-500":"")+(r.getAppointmentStatus(e)==="pending"?"bg-yellow-500":"")+(r.getAppointmentStatus(e)==="canceled"?"bg-red-500":"")),d("title",r.getAppointmentTooltip(e))}}function Mt(a,n){if(a&1&&(t(0,"div",59)(1,"div",60)(2,"span",61),o(3),i(),t(4,"div",62),g(5,Dt,2,3,"ng-container",49),i()()()),a&2){let e=m().$implicit,r=m(2);l(3),p(e.getDate()),l(2),d("ngForOf",r.getAppointmentsForDate(e))}}function wt(a,n){if(a&1&&(G(0),g(1,Mt,6,2,"div",58),z()),a&2){let e=n.$implicit;l(),d("ngIf",e)}}function Et(a,n){if(a&1){let e=D();t(0,"div")(1,"app-card")(2,"app-card-header")(3,"div",15)(4,"div")(5,"app-card-title",16),o(6),i(),t(7,"p",10),o(8,"Calendario de citas"),i()(),t(9,"div",17)(10,"p",18),o(11),i(),t(12,"p",19),o(13,"Total de citas"),i()()()(),t(14,"app-card-content",20)(15,"div",21)(16,"div",22)(17,"div",23)(18,"mat-icon",24),o(19,"check_circle"),i(),t(20,"div")(21,"p",25),o(22,"Completadas"),i(),t(23,"p",26),o(24),i()()()(),t(25,"div",27)(26,"div",23)(27,"mat-icon",28),o(28,"payment"),i(),t(29,"div")(30,"p",29),o(31,"Cobro Pend."),i(),t(32,"p",30),o(33),i()()()(),t(34,"div",31)(35,"div",23)(36,"mat-icon",32),o(37,"event_available"),i(),t(38,"div")(39,"p",33),o(40,"Confirmadas"),i(),t(41,"p",34),o(42),i()()()(),t(43,"div",35)(44,"div",23)(45,"mat-icon",36),o(46,"schedule"),i(),t(47,"div")(48,"p",37),o(49,"Pendientes"),i(),t(50,"p",38),o(51),i()()()(),t(52,"div",39)(53,"div",23)(54,"mat-icon",40),o(55,"cancel"),i(),t(56,"div")(57,"p",41),o(58,"Canceladas"),i(),t(59,"p",42),o(60),i()()()()(),t(61,"div")(62,"div",43)(63,"button",44),u("click",function(){v(e);let s=m();return h(s.previousMonth())}),t(64,"mat-icon"),o(65,"chevron_left"),i()(),t(66,"h3",45),o(67),i(),t(68,"button",44),u("click",function(){v(e);let s=m();return h(s.nextMonth())}),t(69,"mat-icon"),o(70,"chevron_right"),i()()(),t(71,"div",46)(72,"div",47),o(73,"Dom"),i(),t(74,"div",47),o(75,"Lun"),i(),t(76,"div",47),o(77,"Mar"),i(),t(78,"div",47),o(79,"Mi\xE9"),i(),t(80,"div",47),o(81,"Jue"),i(),t(82,"div",47),o(83,"Vie"),i(),t(84,"div",47),o(85,"Sab"),i()(),t(86,"div",48),g(87,wt,2,1,"ng-container",49),i(),t(88,"div",50)(89,"p",51),o(90,"Leyenda"),i(),t(91,"div",52)(92,"div",23),x(93,"div",53),t(94,"span",19),o(95,"Completadas"),i()(),t(96,"div",23),x(97,"div",54),t(98,"span",19),o(99,"Cobro Pendiente"),i()(),t(100,"div",23),x(101,"div",55),t(102,"span",19),o(103,"Confirmadas"),i()(),t(104,"div",23),x(105,"div",56),t(106,"span",19),o(107,"Pendientes"),i()(),t(108,"div",23),x(109,"div",57),t(110,"span",19),o(111,"Canceladas"),i()()()()()()()()}if(a&2){let e=m();l(6),p(e.patientData.nombre),l(5),p(e.getTotalAppointments()),l(13),p(e.getCompletedAppointments()),l(9),p(e.getPendingPaymentAppointments()),l(9),p(e.getTotalAppointments()-e.getCompletedAppointments()-e.getPendingPaymentAppointments()-e.getCanceledAppointments()),l(9),p(e.getPendingAppointments()),l(9),p(e.getCanceledAppointments()),l(7),p(e.getMonthYear()),l(20),d("ngForOf",e.calendarDays)}}var me=class a{constructor(n,e,r){this.data=n;this.dialogRef=e;this.appointmentService=r}patientData=null;calendarDays=[];currentMonth=new Date;loading=!0;destroy$=new P;ngOnInit(){this.loadPatientAppointments(this.data.pacienteId)}loadPatientAppointments(n){this.loading=!0,this.appointmentService.getAppointmentsByPatient(n).pipe(_(this.destroy$)).subscribe({next:e=>{this.patientData={pacienteId:n,nombre:this.data.nombrePaciente,appointments:e},this.generateCalendar(),this.loading=!1},error:e=>{console.error("Error al cargar citas:",e),this.loading=!1}})}generateCalendar(){this.calendarDays=[];let n=this.currentMonth.getFullYear(),e=this.currentMonth.getMonth(),r=new Date(n,e,1),s=new Date(r);s.setDate(s.getDate()-r.getDay());for(let c=0;c<42;c++){c>0&&s.setDate(s.getDate()+1);let y=new Date(s);y.getMonth()===e?this.calendarDays.push(new Date(y)):this.calendarDays.push(null)}}getAppointmentsForDate(n){if(!n||!this.patientData)return[];let e=n.toISOString().split("T")[0];return this.patientData.appointments.filter(r=>new Date(r.fecha).toISOString().split("T")[0]===e)}getAppointmentStatus(n){return n.estadoFisio==="CanceladaFisio"||n.estadoPaciente==="CanceladaPaciente"?"canceled":n.estadoFisio==="Cobrado"?"completed":n.estadoFisio==="CobroPendiente"?"pending-payment":n.estadoFisio==="ConfirmadoFisio"&&n.estadoPaciente==="ConfirmadoPaciente"?"confirmed":"pending"}getAppointmentTooltip(n){let e=new Date(n.fecha).toLocaleDateString("es-ES"),r=new Date(n.fecha).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),s=this.getAppointmentStatus(n),c=this.getStatusText(s);return`${e} ${r} - ${c}`}getStatusText(n){switch(n){case"completed":return"Completada";case"pending-payment":return"Cobro Pendiente";case"confirmed":return"Confirmada";case"pending":return"Pendiente";case"canceled":return"Cancelada";default:return""}}previousMonth(){this.currentMonth=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()-1),this.generateCalendar()}nextMonth(){this.currentMonth=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+1),this.generateCalendar()}getMonthYear(){return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][this.currentMonth.getMonth()]} ${this.currentMonth.getFullYear()}`}getTotalAppointments(){return this.patientData?.appointments.length||0}getCompletedAppointments(){return this.patientData?.appointments.filter(n=>n.estadoFisio==="Cobrado").length||0}getPendingPaymentAppointments(){return this.patientData?.appointments.filter(n=>n.estadoFisio==="CobroPendiente").length||0}getPendingAppointments(){return this.patientData?.appointments.filter(n=>n.estadoFisio!=="Cobrado"&&n.estadoFisio!=="CobroPendiente"&&n.estadoFisio!=="CanceladaFisio"&&n.estadoPaciente!=="CanceladaPaciente").length||0}getCanceledAppointments(){return this.patientData?.appointments.filter(n=>n.estadoFisio==="CanceladaFisio"||n.estadoPaciente==="CanceladaPaciente").length||0}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(f(F),f(k),f(N))};static \u0275cmp=C({type:a,selectors:[["app-patient-appointments-modal"]],features:[Ve([N])],decls:10,vars:3,consts:[[1,"max-h-[calc(100vh-3rem)]","overflow-y-auto","p-6","m-4"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold"],["mat-icon-button","",1,"text-muted-foreground","hover:text-foreground",3,"click"],["class","flex items-center justify-center py-12",4,"ngIf"],[4,"ngIf"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center"],[1,"animate-spin","mb-4","mx-auto"],[1,"text-primary"],[1,"text-muted-foreground"],[1,"max-w-md","w-full"],[1,"p-12","text-center"],[1,"text-muted-foreground","mx-auto","mb-4","opacity-50"],[1,"text-xl","font-semibold","mb-2"],[1,"flex","items-center","justify-between"],[1,"text-3xl","mb-2"],[1,"text-right"],[1,"text-2xl","font-bold","text-primary"],[1,"text-sm","text-muted-foreground"],[1,""],[1,"grid","grid-cols-2","md:grid-cols-5","gap-4","mb-6"],[1,"p-4","rounded-lg","bg-green-50","border-2","border-green-500"],[1,"flex","items-center","gap-2"],[1,"text-green-600","text-sm"],[1,"text-xs","text-green-700"],[1,"text-xl","font-bold","text-green-800"],[1,"p-4","rounded-lg","bg-orange-50","border-2","border-orange-500"],[1,"text-orange-600","text-sm"],[1,"text-xs","text-orange-700"],[1,"text-xl","font-bold","text-orange-800"],[1,"p-4","rounded-lg","bg-blue-50","border-2","border-blue-500"],[1,"text-blue-600","text-sm"],[1,"text-xs","text-blue-700"],[1,"text-xl","font-bold","text-blue-800"],[1,"p-4","rounded-lg","bg-yellow-50","border-2","border-yellow-500"],[1,"text-yellow-600","text-sm"],[1,"text-xs","text-yellow-700"],[1,"text-xl","font-bold","text-yellow-800"],[1,"p-4","rounded-lg","bg-red-50","border-2","border-red-500"],[1,"text-red-600","text-sm"],[1,"text-xs","text-red-700"],[1,"text-xl","font-bold","text-red-800"],[1,"flex","items-center","justify-between","mt-6","mb-4"],[1,"p-2","hover:bg-muted","rounded-lg","transition-colors",3,"click"],[1,"text-xl","font-semibold","text-foreground"],[1,"grid","grid-cols-7","gap-2","mb-2"],[1,"text-center","font-semibold","text-sm","text-muted-foreground","p-2"],[1,"grid","grid-cols-7","gap-2"],[4,"ngFor","ngForOf"],[1,"p-4","rounded-lg","bg-muted/20","border","border-border","mt-5"],[1,"text-sm","font-semibold","text-foreground","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-5","gap-3"],[1,"w-4","h-4","rounded","bg-green-100","border-2","border-green-500"],[1,"w-4","h-4","rounded","bg-orange-100","border-2","border-orange-500"],[1,"w-4","h-4","rounded","bg-blue-100","border-2","border-blue-500"],[1,"w-4","h-4","rounded","bg-yellow-50","border-2","border-yellow-400"],[1,"w-4","h-4","rounded","bg-red-100","border-2","border-red-500"],["class","day-cell",4,"ngIf"],[1,"day-cell"],[1,"w-full","h-16","rounded-lg","border-2","border-gray-300","bg-gray-50","flex","flex-col","items-center","justify-center","transition-all","cursor-pointer","hover:border-primary"],[1,"text-sm","font-semibold","text-foreground","mb-2"],[1,"flex","gap-1","flex-wrap","justify-center","items-center"],[3,"title"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"Citas del Paciente"),i(),t(4,"button",3),u("click",function(){return r.dialogRef.close()}),t(5,"mat-icon"),o(6,"close"),i()()(),g(7,Ct,7,0,"div",4)(8,Pt,9,0,"div",4)(9,Et,112,9,"div",5),i()),e&2&&(l(7),d("ngIf",r.loading),l(),d("ngIf",!r.loading&&!r.patientData||r.patientData&&r.patientData.appointments.length===0),l(),d("ngIf",!r.loading&&r.patientData&&r.patientData.appointments.length>0))},dependencies:[w,T,M,A,I,E,L,ie,ne,W],styles:["@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.day-cell[_ngcontent-%COMP%]{min-height:64px}[_nghost-%COMP%]     .mat-mdc-dialog-container{overflow:visible!important}[_nghost-%COMP%]     .mdc-dialog__content{padding:0!important;overflow:visible!important}"]})};var It=["determinateSpinner"];function At(a,n){if(a&1&&(he(),t(0,"svg",11),x(1,"circle",12),i()),a&2){let e=m();O("viewBox",e._viewBox()),l(),R("stroke-dasharray",e._strokeCircumference(),"px")("stroke-dashoffset",e._strokeCircumference()/2,"px")("stroke-width",e._circleStrokeWidth(),"%"),O("r",e._circleRadius())}}var Tt=new De("mat-progress-spinner-default-options",{providedIn:"root",factory:kt});function kt(){return{diameter:st}}var st=100,Ft=10,lt=(()=>{class a{_elementRef=S(we);_noopAnimations;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;_defaultColor="primary";_determinateCircle;constructor(){let e=S(Ee,{optional:!0}),r=S(Tt);this._noopAnimations=e==="NoopAnimations"&&!!r&&!r._forceAnimations,this.mode=this._elementRef.nativeElement.nodeName.toLowerCase()==="mat-spinner"?"indeterminate":"determinate",r&&(r.color&&(this.color=this._defaultColor=r.color),r.diameter&&(this.diameter=r.diameter),r.strokeWidth&&(this.strokeWidth=r.strokeWidth))}mode;get value(){return this.mode==="determinate"?this._value:0}set value(e){this._value=Math.max(0,Math.min(100,e||0))}_value=0;get diameter(){return this._diameter}set diameter(e){this._diameter=e||0}_diameter=st;get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(e){this._strokeWidth=e||0}_strokeWidth;_circleRadius(){return(this.diameter-Ft)/2}_viewBox(){let e=this._circleRadius()*2+this.strokeWidth;return`0 0 ${e} ${e}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return this.mode==="determinate"?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=C({type:a,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(r,s){if(r&1&&Te(It,5),r&2){let c;ke(c=Fe())&&(s._determinateCircle=c.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:18,hostBindings:function(r,s){r&2&&(O("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow",s.mode==="determinate"?s.value:null)("mode",s.mode),j("mat-"+s.color),R("width",s.diameter,"px")("height",s.diameter,"px")("--mdc-circular-progress-size",s.diameter+"px")("--mdc-circular-progress-active-indicator-width",s.diameter+"px"),Ae("_mat-animation-noopable",s._noopAnimations)("mdc-circular-progress--indeterminate",s.mode==="indeterminate"))},inputs:{color:"color",mode:"mode",value:[2,"value","value",Z],diameter:[2,"diameter","diameter",Z],strokeWidth:[2,"strokeWidth","strokeWidth",Z]},exportAs:["matProgressSpinner"],decls:14,vars:11,consts:[["circle",""],["determinateSpinner",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(r,s){if(r&1&&(g(0,At,2,8,"ng-template",null,0,U),t(2,"div",2,1),he(),t(4,"svg",3),x(5,"circle",4),i()(),Me(),t(6,"div",5)(7,"div",6)(8,"div",7),Q(9,8),i(),t(10,"div",9),Q(11,8),i(),t(12,"div",10),Q(13,8),i()()()),r&2){let c=Y(1);l(4),O("viewBox",s._viewBox()),l(),R("stroke-dasharray",s._strokeCircumference(),"px")("stroke-dashoffset",s._strokeDashOffset(),"px")("stroke-width",s._circleStrokeWidth(),"%"),O("r",s._circleRadius()),l(4),d("ngTemplateOutlet",c),l(2),d("ngTemplateOutlet",c),l(2),d("ngTemplateOutlet",c)}},dependencies:[Le],styles:[`.mat-mdc-progress-spinner{display:block;overflow:hidden;line-height:0;position:relative;direction:ltr;transition:opacity 250ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-progress-spinner circle{stroke-width:var(--mdc-circular-progress-active-indicator-width, 4px)}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1;animation:mdc-circular-progress-container-rotate 1568.2352941176ms linear infinite}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mdc-circular-progress-active-indicator-color, var(--mat-sys-primary))}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}
`],encapsulation:2,changeDetection:0})}return a})();var pe=(()=>{class a{static \u0275fac=function(r){return new(r||a)};static \u0275mod=Ie({type:a});static \u0275inj=Pe({imports:[tt]})}return a})();function Rt(a,n){a&1&&(t(0,"div",20)(1,"mat-icon",21),o(2,"error"),i(),o(3," Las notas no pueden estar vac\xEDas "),i())}function jt(a,n){if(a&1&&(t(0,"span"),o(1),i()),a&2){let e=m();l(),b("\xDAltima actualizaci\xF3n: ",e.formatDateTime(e.existingNote.updatedAt),"")}}function Vt(a,n){a&1&&(t(0,"span"),o(1,"Sin notas previas"),i())}function $t(a,n){a&1&&(t(0,"mat-icon",22),o(1,"refresh"),i())}function Lt(a,n){a&1&&(t(0,"span"),o(1,"Guardar Notas"),i())}function Wt(a,n){a&1&&(t(0,"span"),o(1,"Guardando..."),i())}var ge=class a{constructor(n,e){this.data=n;this.dialogRef=e;this.appointmentId=n.appointmentId,this.appointmentDate=n.appointmentDate,this.appointmentTime=n.appointmentTime,this.appointmentType=n.appointmentType,this.pacienteName=n.pacienteName,this.notesForm=this.fb.group({contenido:["",[ye.required,ye.minLength(1)]]})}appointmentId;appointmentDate;appointmentTime;appointmentType;pacienteName;notesForm;existingNote=null;isSubmitting=!1;loading=!0;destroy$=new P;apiUrl=`${Ue.apiUrl}/api/followup-notes`;fb=S(Xe);http=S(Be);toastService=S($);ngOnInit(){this.loadExistingNote()}loadExistingNote(){this.loading=!0,this.http.get(`${this.apiUrl}/${this.appointmentId}`).pipe(_(this.destroy$)).subscribe({next:n=>{this.existingNote=n,this.notesForm.patchValue({contenido:n.contenido}),this.loading=!1},error:()=>{this.loading=!1}})}isFieldInvalid(n){let e=this.notesForm.get(n);return!!(e&&e.invalid&&(e.dirty||e.touched))}onSubmit(){if(!this.notesForm.valid){this.toastService.error("Por favor completa todos los campos requeridos");return}this.isSubmitting=!0;let{contenido:n}=this.notesForm.value,e={appointmentId:this.appointmentId,contenido:n};this.existingNote?this.http.put(`${this.apiUrl}/${this.existingNote.id}`,e).pipe(_(this.destroy$)).subscribe({next:r=>{this.existingNote=r,this.isSubmitting=!1,this.dialogRef.close({success:!0,message:"Nota actualizada correctamente"})},error:r=>{console.error("Error updating note:",r),this.toastService.error("Error al actualizar la nota"),this.isSubmitting=!1}}):this.http.post(this.apiUrl,e).pipe(_(this.destroy$)).subscribe({next:r=>{this.existingNote=r,this.isSubmitting=!1,this.dialogRef.close({success:!0,message:"Nota guardada correctamente"})},error:r=>{console.error("Error creating note:",r),this.toastService.error("Error al guardar la nota"),this.isSubmitting=!1}})}formatDate(n){let[e,r,s]=n.split("-").map(Number);return new Date(e,r-1,s).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}formatDateTime(n){let e=new Date(n);return e.toLocaleDateString("es-ES")+" "+e.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}onCancel(){this.dialogRef.close()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(f(F),f(k))};static \u0275cmp=C({type:a,selectors:[["app-followup-notes-modal"]],decls:31,vars:12,consts:[[1,"w-full","max-w-2xl","flex","flex-col","max-h-[95vh]","overflow-hidden"],[1,"flex","items-center","justify-between","mb-6","pb-4","border-b","border-border","px-6","pt-6","flex-shrink-0"],[1,"flex-1"],[1,"text-2xl","font-bold","text-foreground"],[1,"text-sm","text-muted-foreground","mt-1"],[1,"text-sm","text-muted-foreground"],["type","button","title","Cerrar",1,"ml-4","p-0","rounded-lg","hover:bg-muted","transition-colors","text-muted-foreground","hover:text-foreground","flex-shrink-0",3,"click"],[1,"overflow-y-auto","flex-1","px-6","pb-6"],[1,"space-y-4",3,"formGroup"],[1,"space-y-2"],[1,"text-sm","font-semibold","text-foreground","flex","items-center","gap-2"],[1,"text-primary"],["formControlName","contenido","placeholder","Escribe aqu\xED las notas sobre el seguimiento de esta cita...","rows","8",1,"w-full","px-4","py-3","border","border-input","rounded-lg","bg-background","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-primary","focus:border-transparent","transition-all","resize-none"],["class","text-sm text-destructive flex items-center gap-1 mt-1",4,"ngIf"],[1,"text-xs","text-muted-foreground"],[4,"ngIf"],[1,"flex","gap-3","px-6","pb-6","border-t","border-border","flex-shrink-0","pt-6"],["type","button",1,"flex-1","px-4","py-3","rounded-lg","border","border-border","text-foreground","bg-background","hover:bg-muted","transition-colors","font-medium",3,"click"],["type","submit",1,"flex-1","px-4","py-3","rounded-lg","bg-primary","text-primary-foreground","hover:bg-primary/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","font-medium","flex","items-center","justify-center","gap-2",3,"click","disabled"],["class","animate-spin",4,"ngIf"],[1,"text-sm","text-destructive","flex","items-center","gap-1","mt-1"],[1,"text-sm"],[1,"animate-spin"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),o(4,"Notas de Seguimiento"),i(),t(5,"p",4),o(6),i(),t(7,"p",5),o(8),i()(),t(9,"button",6),u("click",function(){return r.onCancel()}),t(10,"mat-icon"),o(11,"close"),i()()(),t(12,"div",7)(13,"form",8)(14,"div",9)(15,"label",10)(16,"mat-icon",11),o(17,"edit_note"),i(),o(18," Notas de Seguimiento "),i(),x(19,"textarea",12),g(20,Rt,4,0,"div",13),t(21,"p",14),g(22,jt,2,1,"span",15)(23,Vt,2,0,"span",15),i()()()(),t(24,"div",16)(25,"button",17),u("click",function(){return r.onCancel()}),o(26," Cancelar "),i(),t(27,"button",18),u("click",function(){return r.onSubmit()}),g(28,$t,2,0,"mat-icon",19)(29,Lt,2,0,"span",15)(30,Wt,2,0,"span",15),i()()()),e&2&&(l(6),p(r.pacienteName),l(2),K("",r.formatDate(r.appointmentDate)," - ",r.appointmentTime," (",r.appointmentType,")"),l(5),d("formGroup",r.notesForm),l(7),d("ngIf",r.isFieldInvalid("contenido")),l(2),d("ngIf",r.existingNote),l(),d("ngIf",!r.existingNote),l(4),d("disabled",!r.notesForm.valid||r.isSubmitting),l(),d("ngIf",r.isSubmitting),l(),d("ngIf",!r.isSubmitting),l(),d("ngIf",r.isSubmitting))},dependencies:[w,M,te,Qe,X,ee,qe,et,Ke,Ze,A,I,E,pe],encapsulation:2})};function Bt(a,n){a&1&&(t(0,"div",12)(1,"div",13),x(2,"mat-spinner",14),t(3,"p",15),o(4,"Cargando citas..."),i()()())}function Gt(a,n){a&1&&(t(0,"div",16)(1,"mat-icon",17),o(2,"event_note"),i(),t(3,"p",15),o(4,"No hay citas cobradas o con cobro pendiente"),i()())}function zt(a,n){if(a&1){let e=D();t(0,"div",20)(1,"div",21)(2,"div",2)(3,"div",22)(4,"mat-icon",15),o(5,"calendar_today"),i(),t(6,"div")(7,"h4",23),o(8),i(),t(9,"p",24),o(10),i()()(),t(11,"div",25)(12,"span",26),o(13),i(),t(14,"span",27),o(15),i()()(),t(16,"div",28)(17,"button",29),u("click",function(){let s=v(e).$implicit,c=m(2);return h(c.openNotesModal(s))}),t(18,"mat-icon"),o(19,"note_add"),i()()()()()}if(a&2){let e=n.$implicit,r=m(2);l(8),p(r.formatDate(r.getAppointmentDate(e))),l(2),p(r.getAppointmentTime(e)),l(3),b(" ",r.getAppointmentType(e)," "),l(),d("ngClass",e.statusPago==="cobrado"?"bg-green-500/20 text-green-600":"bg-yellow-500/20 text-yellow-600"),l(),b(" ",e.statusPago==="cobrado"?"Cobrado":"Cobro Pendiente"," ")}}function Yt(a,n){if(a&1&&(t(0,"div",18),g(1,zt,20,5,"div",19),i()),a&2){let e=m();l(),d("ngForOf",e.appointments)}}var ue=class a{constructor(n,e){this.data=n;this.dialogRef=e;this.pacienteId=n.pacienteId,this.pacienteName=n.nombrePaciente}pacienteName;pacienteId;appointments=[];loading=!0;destroy$=new P;appointmentService=S(N);paymentService=S(at);toastService=S($);dialog=S(re);ngOnInit(){this.loadAppointments()}loadAppointments(){this.loading=!0,this.appointmentService.getAppointmentsByPatient(this.pacienteId).pipe(_(this.destroy$)).subscribe({next:n=>{console.log("\u{1F4CB} Total appointments loaded:",n.length),console.log("\u{1F4CB} Appointments:",n);let e=n.map(r=>this.paymentService.getPaymentByAppointmentId(r.id).pipe(_(this.destroy$)).toPromise().then(s=>(console.log(`\u{1F4B3} Payment info for ${r.id}:`,s),ve(xe({},r),{paymentInfo:s,statusPago:s?.isPendingPayment?"pendiente":"cobrado"}))).catch(s=>(console.warn(`\u26A0\uFE0F No payment info for ${r.id}:`,s.message),ve(xe({},r),{paymentInfo:void 0,statusPago:"pendiente"}))));Promise.all(e).then(r=>{console.log("\u2705 All appointments with payment info:",r),this.appointments=r.filter(s=>s.paymentInfo!==void 0),console.log("\u{1F4CA} Filtered appointments with payment info:",this.appointments.length),this.loading=!1})},error:n=>{console.error("\u274C Error loading appointments:",n),this.toastService.error("Error al cargar las citas"),this.loading=!1}})}formatDate(n){let[e,r,s]=n.split("-").map(Number);return new Date(e,r-1,s).toLocaleDateString("es-ES",{weekday:"short",day:"numeric",month:"short"})}getAppointmentDate(n){return n?.fecha||""}getAppointmentTime(n){return n?.hora||""}getAppointmentType(n){return n?.tipo||""}openNotesModal(n){this.dialog.open(ge,{width:"600px",maxWidth:"90vw",data:{appointmentId:n.id,appointmentDate:n.fecha,appointmentTime:n.hora,appointmentType:n.tipo,pacienteName:this.pacienteName}}).afterClosed().subscribe(r=>{r&&r.success&&this.toastService.success(r.message||"Nota actualizada correctamente")})}onClose(){this.dialogRef.close()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(f(F),f(k))};static \u0275cmp=C({type:a,selectors:[["app-patient-followup-modal"]],decls:17,vars:4,consts:[[1,"w-full","max-w-4xl","flex","flex-col","max-h-[95vh]","overflow-hidden"],[1,"flex","items-center","justify-between","mb-6","pb-4","border-b","border-border","px-6","pt-6","flex-shrink-0"],[1,"flex-1"],[1,"text-3xl","font-bold","text-foreground"],[1,"text-sm","text-muted-foreground","mt-2"],["type","button","title","Cerrar",1,"ml-4","p-0","rounded-lg","hover:bg-muted","transition-colors","text-muted-foreground","hover:text-foreground","flex-shrink-0",3,"click"],[1,"overflow-y-auto","flex-1","px-6","pb-6"],["class","flex items-center justify-center h-64",4,"ngIf"],["class","text-center py-12",4,"ngIf"],["class","space-y-3",4,"ngIf"],[1,"flex","gap-3","px-6","pb-6","border-t","border-border","flex-shrink-0","pt-6"],["type","button",1,"flex-1","px-4","py-3","rounded-lg","border","border-border","text-foreground","bg-background","hover:bg-muted","transition-colors","font-medium",3,"click"],[1,"flex","items-center","justify-center","h-64"],[1,"text-center"],["diameter","40",1,"mx-auto","mb-4"],[1,"text-muted-foreground"],[1,"text-center","py-12"],[1,"text-muted-foreground","mx-auto","mb-4","opacity-50","text-5xl"],[1,"space-y-3"],["class","p-4 rounded-lg border border-border bg-muted/30 hover:bg-muted/50 transition-colors",4,"ngFor","ngForOf"],[1,"p-4","rounded-lg","border","border-border","bg-muted/30","hover:bg-muted/50","transition-colors"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex","items-center","gap-3","mb-2"],[1,"font-semibold","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"flex","items-center","gap-2","mt-3","flex-wrap"],[1,"inline-block","px-3","py-1","rounded-full","bg-blue-500/20","text-blue-600","text-xs","font-medium"],[1,"inline-block","px-3","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"flex","items-center","gap-2","flex-shrink-0"],["type","button","title","Agregar o editar notas de seguimiento",1,"p-3","rounded-lg","border","border-border","text-foreground","bg-background","hover:bg-muted","transition-colors","flex","items-center","justify-center",3,"click"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),o(4),i(),t(5,"p",4),o(6,"Historial de citas cobradas o con cobro pendiente"),i()(),t(7,"button",5),u("click",function(){return r.onClose()}),t(8,"mat-icon"),o(9,"close"),i()()(),t(10,"div",6),g(11,Bt,5,0,"div",7)(12,Gt,5,0,"div",8)(13,Yt,2,1,"div",9),i(),t(14,"div",10)(15,"button",11),u("click",function(){return r.onClose()}),o(16," Cerrar "),i()()()),e&2&&(l(4),b("Seguimiento de ",r.pacienteName,""),l(7),d("ngIf",r.loading),l(),d("ngIf",!r.loading&&r.appointments.length===0),l(),d("ngIf",!r.loading&&r.appointments.length>0))},dependencies:[w,V,T,M,A,I,E,pe,lt],encapsulation:2})};var Ut=a=>({"border-2 border-destructive bg-destructive/5":a});function Ht(a,n){if(a&1&&(t(0,"div",34)(1,"div",35)(2,"span",7),o(3,"Progreso del Programa"),i(),t(4,"span",36),o(5),i()(),t(6,"div",37),x(7,"div",38),i()()),a&2){let e=m().$implicit;l(5),K(" ",e.diasCompletados,"/",e.diasTotales," d\xEDas (",e.porcentajeProgreso,"%) "),l(2),R("width",e.porcentajeProgreso,"%")}}function qt(a,n){a&1&&(t(0,"div",39)(1,"div",30)(2,"mat-icon",40),o(3,"info"),i(),t(4,"span"),o(5,"Sin programa activo"),i()()())}function Jt(a,n){if(a&1){let e=D();t(0,"div",19)(1,"app-card",20),u("click",function(){let s=v(e).$implicit,c=m(2);return h(c.selectPaciente(s))}),t(2,"app-card-content",21)(3,"div",22)(4,"div",23)(5,"div",24)(6,"div",25)(7,"span",26),o(8),i()(),t(9,"div")(10,"h3",27),o(11),i(),t(12,"p",28),o(13),i()()(),t(14,"div",29)(15,"div",30)(16,"mat-icon"),o(17,"phone"),i(),t(18,"span"),o(19),i()(),t(20,"div",30)(21,"mat-icon"),o(22,"email"),i(),t(23,"span",31),o(24),i()(),t(25,"div",30)(26,"mat-icon"),o(27,"calendar_today"),i(),t(28,"span"),o(29),i()()(),g(30,Ht,8,5,"div",32)(31,qt,6,0,"div",33),i()()()()()}if(a&2){let e=n.$implicit,r=m(2);l(),d("ngClass",$e(9,Ut,(r.selectedPaciente==null?null:r.selectedPaciente.id)===e.id)),l(7),b(" ",r.getInitials(e.nombre)," "),l(3),p(e.nombre),l(2),b("",r.calculateAge(e.fechaNacimiento)," a\xF1os"),l(6),p(e.telefono||"Sin tel\xE9fono"),l(5),p(e.email),l(5),b("Ingreso: ",r.formatDate(e.fechaIngreso),""),l(),d("ngIf",e.tieneProgramaActivo),l(),d("ngIf",!e.tieneProgramaActivo)}}function Qt(a,n){if(a&1&&(t(0,"div"),g(1,Jt,32,11,"div",18),i()),a&2){let e=m();l(),d("ngForOf",e.filteredPacientes)}}function Kt(a,n){a&1&&(t(0,"mat-icon",45),o(1,"person_off"),i())}function Zt(a,n){a&1&&(t(0,"div",46)(1,"mat-icon",47),o(2,"refresh"),i()())}function Xt(a,n){if(a&1&&(t(0,"app-card",41)(1,"div",42),g(2,Kt,2,0,"mat-icon",43)(3,Zt,3,0,"div",44),t(4,"p",7),o(5),i()()()),a&2){let e=m();l(2),d("ngIf",!e.loading),l(),d("ngIf",e.loading),l(2),p(e.loading?"Cargando pacientes...":"No hay pacientes para mostrar")}}function ei(a,n){if(a&1){let e=D();t(0,"div",48)(1,"app-card")(2,"app-card-content",49)(3,"div",50)(4,"button",51),u("click",function(){v(e);let s=m();return h(s.navigateToFollowup())}),t(5,"mat-icon"),o(6,"note_add"),i(),o(7," Seguimiento "),i(),t(8,"button",51),u("click",function(){v(e);let s=m();return h(s.navigateToProgress())}),t(9,"mat-icon"),o(10,"bar_chart"),i(),o(11," Ver Progreso Detallado "),i(),t(12,"button",51),u("click",function(){v(e);let s=m();return h(s.navigateToAppointments())}),t(13,"mat-icon"),o(14,"event"),i(),o(15," Ver Calendario de Citas "),i(),t(16,"button",51),u("click",function(){v(e);let s=m();return h(s.openAssignRoutineModal())}),t(17,"mat-icon"),o(18,"fitness_center"),i(),o(19),i(),t(20,"button",52),u("click",function(){v(e);let s=m();return h(s.openDeleteConfirmModal())}),t(21,"mat-icon"),o(22,"delete"),i(),o(23," Desvincular Paciente "),i()()()()()}if(a&2){let e=m();l(19),b(" ",e.programaActivo?"Rutina":"Asignar Rutina"," ")}}function ti(a,n){a&1&&(t(0,"app-card",48)(1,"app-card-content",53)(2,"mat-icon",54),o(3,"person"),i(),t(4,"p",7),o(5,"Selecciona un paciente para ver sus opciones"),i()()())}var dt=class a{constructor(n,e,r,s,c,y,B){this.appointmentService=n;this.authService=e;this.programaService=r;this.router=s;this.dialog=c;this.toastService=y;this.activatedRoute=B}pacientes=[];selectedPaciente=null;programaActivo=null;searchTerm="";loading=!0;fisioterapeutaId="";destroy$=new P;navLinks=[{label:"Dashboard",route:"/fisioterapeuta/dashboard"},{label:"Agenda",route:"/fisioterapeuta/agenda"},{label:"Pacientes",route:"/fisioterapeuta/pacientes"},{label:"Historial de Cobros",route:"/fisioterapeuta/historial-cobros"}];ngOnInit(){let n=this.authService.getUserId();n?(this.fisioterapeutaId=n,this.loadPacientes()):(this.toastService.error("No se pudo obtener el ID del usuario"),this.router.navigate(["/"]))}loadPacientes(){this.loading=!0,this.appointmentService.getLinkedPatients(this.fisioterapeutaId).pipe(_(this.destroy$)).subscribe({next:n=>{this.pacientes=n,this.loading=!1,this.activatedRoute.queryParams.pipe(_(this.destroy$)).subscribe(e=>{if(e.pacienteId){let r=e.pacienteId,s=this.pacientes.find(c=>c.id===r);s&&this.selectPaciente(s)}})},error:n=>{console.error("Error loading patients:",n),this.toastService.error("Error al cargar los pacientes"),this.loading=!1}})}get filteredPacientes(){return this.searchTerm?this.pacientes.filter(n=>n.nombre.toLowerCase().includes(this.searchTerm.toLowerCase())):this.pacientes}selectPaciente(n){this.selectedPaciente=n,this.programaActivo=null,this.programaService.obtenerProgramaActivoPorPaciente(n.id).pipe(_(this.destroy$),Ce(()=>Se(null))).subscribe({next:e=>{this.programaActivo=e},error:()=>{this.programaActivo=null}})}openAddPatientModal(){this.dialog.open(nt,{width:"600px",maxWidth:"90vw"}).afterClosed().subscribe(e=>{if(e){let r={pacienteId:e.pacienteId};this.appointmentService.linkPatient(this.fisioterapeutaId,r).pipe(_(this.destroy$)).subscribe({next:s=>{this.pacientes.push(s),this.selectedPaciente=s,this.toastService.success("Paciente vinculado exitosamente")},error:s=>{console.error("Error linking patient:",s);let c=s.error?.error||"Error al vincular el paciente";this.toastService.error(c)}})}})}openAssignRoutineModal(){if(!this.selectedPaciente){this.toastService.error("Selecciona un paciente primero");return}this.dialog.open(rt,{width:"900px",maxWidth:"95vw",data:{pacienteName:this.selectedPaciente.nombre,pacienteId:this.selectedPaciente.id,programaActivo:this.programaActivo}}).afterClosed().subscribe(e=>{e&&e.success&&(console.log("Programa creado/actualizado:",e.programa),this.toastService.success(e.mensaje||"Programa de rehabilitaci\xF3n guardado exitosamente"),this.selectedPaciente&&this.selectPaciente(this.selectedPaciente))})}openDeleteConfirmModal(){if(!this.selectedPaciente)return;this.dialog.open(ot,{width:"600px",maxWidth:"90vw",data:{title:"Desvincular Paciente",message:"\xBFEst\xE1s seguro de que deseas desvincular este paciente? Esta acci\xF3n no se puede deshacer.",pacienteNombre:this.selectedPaciente.nombre,pacienteEmail:this.selectedPaciente.email,pacienteTelefono:this.selectedPaciente.telefono,diagnostico:this.selectedPaciente.diagnostico,confirmText:"Desvincular",cancelText:"Cancelar",isDangerous:!0}}).afterClosed().subscribe(e=>{e&&this.deletePaciente()})}deletePaciente(){this.selectedPaciente&&this.appointmentService.unlinkPatient(this.fisioterapeutaId,this.selectedPaciente.id).pipe(_(this.destroy$)).subscribe({next:()=>{this.pacientes=this.pacientes.filter(n=>n.id!==this.selectedPaciente?.id),this.selectedPaciente=null,this.toastService.success("Paciente desvinculado exitosamente")},error:n=>{console.error("Error unlinking patient:",n),this.toastService.error("Error al desvincular el paciente")}})}getInitials(n){return n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}calculateAge(n){if(!n)return 0;let e=new Date,r=new Date(n),s=e.getFullYear()-r.getFullYear(),c=e.getMonth()-r.getMonth();return(c<0||c===0&&e.getDate()<r.getDate())&&s--,s}formatDate(n){return new Date(n).toLocaleDateString("es-ES")}onChangeInfo(){console.log("Cambiar informaci\xF3n - pendiente de implementar")}logout(){this.authService.logout(),this.router.navigate(["/"])}navigateToProgress(){if(!this.selectedPaciente){this.toastService.error("Selecciona un paciente primero");return}let n=this.dialog.open(ae,{width:"900px",maxWidth:"95vw",data:{pacienteId:this.selectedPaciente.id,nombrePaciente:this.selectedPaciente.nombre}})}navigateToAppointments(){if(!this.selectedPaciente){this.toastService.error("Selecciona un paciente primero");return}let n=this.dialog.open(me,{width:"900px",maxWidth:"95vw",data:{pacienteId:this.selectedPaciente.id,nombrePaciente:this.selectedPaciente.nombre}})}navigateToFollowup(){if(!this.selectedPaciente){this.toastService.error("Selecciona un paciente primero");return}let n=this.dialog.open(ue,{width:"900px",maxWidth:"95vw",data:{pacienteId:this.selectedPaciente.id,nombrePaciente:this.selectedPaciente.nombre}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||a)(f(N),f(He),f(oe),f(ze),f(re),f($),f(Ge))};static \u0275cmp=C({type:a,selectors:[["app-pacientes"]],decls:28,vars:6,consts:[["noPacientesOrLoading",""],["noSelection",""],[1,"min-h-screen","bg-background"],[3,"changeInfo","logout","navLinks"],[1,"container","mx-auto","px-4","py-8"],[1,"flex","items-center","justify-between","mb-8"],[1,"text-4xl","font-bold","mb-2"],[1,"text-muted-foreground"],[1,"flex","items-center","gap-2","px-6","py-3","rounded-lg","bg-primary","text-primary-foreground","hover:bg-primary/90","transition-colors","font-medium",3,"click"],[1,"mb-6"],[1,"relative"],["type","text","placeholder","Buscar pacientes por nombre...",1,"w-full","px-4","py-3","pl-10","rounded-lg","border","border-input","bg-background","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-primary","focus:border-transparent","transition-all",3,"ngModelChange","ngModel"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-muted-foreground","pointer-events-none"],[1,"grid","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2","space-y-4"],[4,"ngIf","ngIfElse"],[1,"lg:col-span-1"],["class","sticky top-24",4,"ngIf","ngIfElse"],["class","space-y-4",4,"ngFor","ngForOf"],[1,"space-y-4"],[1,"cursor-pointer","hover:shadow-lg","transition-all",3,"click","ngClass"],[1,"p-6"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-12","h-12","rounded-full","bg-primary/10","flex","items-center","justify-center","flex-shrink-0"],[1,"text-lg","font-semibold","text-primary"],[1,"text-lg","font-semibold","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"grid","grid-cols-2","gap-4","mb-3"],[1,"flex","items-center","gap-2","text-sm","text-muted-foreground"],[1,"truncate"],["class","mt-4 space-y-2",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"mt-4","space-y-2"],[1,"flex","items-center","justify-between","text-sm"],[1,"font-medium","text-foreground"],[1,"w-full","bg-muted","rounded-full","h-2","overflow-hidden"],[1,"bg-primary","h-full","transition-all","duration-300"],[1,"mt-4"],[1,"text-base"],[1,"text-center","p-12"],[1,"flex","flex-col","items-center","justify-center"],["class","text-muted-foreground mb-4 opacity-50",4,"ngIf"],["class","animate-spin",4,"ngIf"],[1,"text-muted-foreground","mb-4","opacity-50"],[1,"animate-spin"],[1,"text-primary","mb-4"],[1,"sticky","top-24"],[1,"space-y-6"],[1,"space-y-2","border-border"],[1,"w-full","px-4","py-3","rounded-lg","border","border-border","text-foreground","bg-background","hover:bg-muted","transition-colors","font-medium","flex","items-center","justify-center","gap-2",3,"click"],[1,"w-full","px-4","py-3","rounded-lg","border","border-destructive","text-destructive","bg-background","hover:bg-destructive/10","transition-colors","font-medium","flex","items-center","justify-center","gap-2",3,"click"],[1,"p-12","text-center"],[1,"text-muted-foreground","mx-auto","mb-4","opacity-50"]],template:function(e,r){if(e&1){let s=D();t(0,"div",2)(1,"app-header",3),u("changeInfo",function(){return v(s),h(r.onChangeInfo())})("logout",function(){return v(s),h(r.logout())}),i(),t(2,"main",4)(3,"div",5)(4,"div")(5,"h2",6),o(6,"Gesti\xF3n de Pacientes"),i(),t(7,"p",7),o(8,"Administra la informaci\xF3n de tus pacientes"),i()(),t(9,"button",8),u("click",function(){return v(s),h(r.openAddPatientModal())}),t(10,"mat-icon"),o(11,"add"),i(),t(12,"span"),o(13,"Vincular Paciente"),i()()(),t(14,"div",9)(15,"div",10)(16,"input",11),je("ngModelChange",function(y){return v(s),Re(r.searchTerm,y)||(r.searchTerm=y),h(y)}),i(),t(17,"mat-icon",12),o(18,"search"),i()()(),t(19,"div",13)(20,"div",14),g(21,Qt,2,1,"div",15)(22,Xt,6,3,"ng-template",null,0,U),i(),t(24,"div",16),g(25,ei,24,1,"div",17)(26,ti,6,0,"ng-template",null,1,U),i()()()()}if(e&2){let s=Y(23),c=Y(27);l(),d("navLinks",r.navLinks),l(15),Oe("ngModel",r.searchTerm),l(5),d("ngIf",!r.loading&&r.filteredPacientes.length>0)("ngIfElse",s),l(4),d("ngIf",r.selectedPaciente)("ngIfElse",c)}},dependencies:[w,V,T,M,Ye,te,X,ee,Je,A,I,E,L,W,it],encapsulation:2})};export{dt as PacientesComponent};
