import{a as J,b as K}from"./chunk-Z6D676T2.js";import{a as A}from"./chunk-T3SLRWRV.js";import{a as P}from"./chunk-X3IRCCKU.js";import{b as D,d as U,f as R,s as j}from"./chunk-BKO5ELJN.js";import{b as O,c as V,d as B,e as N,f as W}from"./chunk-AXJP532N.js";import{a as E}from"./chunk-RWZ5TKRV.js";import{c as q,e as G}from"./chunk-BV64I7NB.js";import"./chunk-Y2M3SQ4J.js";import{Ba as t,Bb as T,C as y,Ca as i,Ha as S,Ja as c,Jb as M,Ka as x,Lb as F,Ob as I,P as _,Q as w,Ta as n,Ua as g,Va as k,Ya as f,Za as h,_a as v,da as a,g as b,ha as u,la as C,pa as m,pc as z,qc as H,ta as l,vb as L}from"./chunk-OSJLVL2X.js";function X(p,r){p&1&&(t(0,"span"),n(1,"Iniciar Sesi\xF3n"),i())}function Y(p,r){p&1&&(t(0,"span",24)(1,"mat-icon",25),n(2,"refresh"),i(),n(3," Cargando... "),i())}function Z(p,r){if(p&1){let o=S();t(0,"button",26),c("click",function(){_(o);let s=x();return w(s.openUnlockModal())}),n(1," \xBFProblemas para entrar? Desbloquear cuenta "),i()}}var Q=class p{constructor(r,o,e,s,d){this.authService=r;this.toastService=o;this.router=e;this.route=s;this.dialog=d}userType="patient";loginForm={email:"",password:""};isLoading=!1;showPassword=!1;showUnlockLink=!1;destroy$=new b;ngOnInit(){this.route.data.subscribe(r=>{this.userType=r.userType||"patient"})}login(){if(!this.loginForm.email||!this.loginForm.password){this.toastService.warning("Por favor completa todos los campos");return}this.isLoading=!0,this.authService.login(this.loginForm).pipe(y(this.destroy$)).subscribe({next:r=>{this.authService.setToken(r.token);let o=this.authService.getUserRole();if(this.userType==="physiotherapist"&&o!=="physiotherapist"){this.isLoading=!1,this.toastService.error("Esta cuenta no es de fisioterapeuta. Por favor, usa el login de paciente."),this.authService.logout();return}if(this.userType==="patient"&&o!=="patient"){this.isLoading=!1,this.toastService.error("Esta cuenta no es de paciente. Por favor, usa el login de fisioterapeuta."),this.authService.logout();return}this.toastService.success("\xA1Sesi\xF3n iniciada exitosamente!");let e=o==="physiotherapist"?"/fisioterapeuta/dashboard":"/paciente/dashboard";setTimeout(()=>{this.router.navigate([e])},500)},error:r=>{this.isLoading=!1;let o=r.error?.error||"Error al iniciar sesi\xF3n";o.toLowerCase().includes("locked")?(this.showUnlockLink=!0,this.toastService.error("Tu cuenta ha sido bloqueada por seguridad")):this.toastService.error(o)}})}togglePasswordVisibility(){this.showPassword=!this.showPassword}goToSignUp(){let r=this.userType==="physiotherapist"?"/registro/fisioterapeuta":"/registro/paciente";this.router.navigate([r])}goToHome(){this.router.navigate(["/"])}openUnlockModal(){this.dialog.open(J,{width:"400px",disableClose:!1,data:{email:this.loginForm.email}})}openForgotPasswordModal(){this.dialog.open(K,{width:"400px",disableClose:!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(o){return new(o||p)(u(E),u(P),u(F),u(M),u(q))};static \u0275cmp=C({type:p,selectors:[["app-login"]],decls:37,vars:13,consts:[[1,"min-h-screen","bg-gradient-to-br","from-background","via-background","to-muted/20","flex","items-center","justify-center","p-4"],[1,"w-full","max-w-md","shadow-xl","relative"],["type","button","title","Volver a inicio",1,"absolute","top-4","left-4","p-2","text-muted-foreground","hover:text-foreground","transition-colors","rounded-md","hover:bg-muted/50","z-10",3,"click"],[1,"h-6","w-6"],[1,"space-y-2","pb-6"],[1,"flex","items-center","justify-center","gap-2","mb-4"],[1,"h-8","w-8","text-primary"],[1,"text-2xl"],[1,"text-center","text-base"],[1,"space-y-6"],[1,"space-y-2"],[1,"text-sm","font-medium","text-foreground"],["type","email","placeholder","tu@correo.com",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],[1,"relative"],["placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-3","py-2","pr-10","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","type","ngModel","disabled"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-muted-foreground","hover:text-foreground","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"!size-5"],[1,"flex","justify-center","pt-2"],["size","lg",1,"px-12",3,"click","disabled"],[4,"ngIf"],["class","flex items-center gap-2",4,"ngIf"],[1,"space-y-3","pt-4","border-t","border-border"],["type","button",1,"w-full","text-sm","text-primary","hover:underline","transition-colors","text-center",3,"click"],["type","button","class","w-full text-sm text-destructive hover:underline transition-colors text-center",3,"click",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"animate-spin"],["type","button",1,"w-full","text-sm","text-destructive","hover:underline","transition-colors","text-center",3,"click"]],template:function(o,e){o&1&&(t(0,"div",0)(1,"app-card",1)(2,"button",2),c("click",function(){return e.goToHome()}),t(3,"mat-icon",3),n(4,"arrow_back"),i()(),t(5,"app-card-header",4)(6,"div",5)(7,"mat-icon",6),n(8),i(),t(9,"app-card-title",7),n(10),i()(),t(11,"app-card-description",8),n(12," Inicia sesi\xF3n en tu cuenta "),i()(),t(13,"app-card-content")(14,"div",9)(15,"div",10)(16,"label",11),n(17,"Correo Electr\xF3nico"),i(),t(18,"input",12),v("ngModelChange",function(d){return h(e.loginForm.email,d)||(e.loginForm.email=d),d}),i()(),t(19,"div",10)(20,"label",11),n(21,"Contrase\xF1a"),i(),t(22,"div",13)(23,"input",14),v("ngModelChange",function(d){return h(e.loginForm.password,d)||(e.loginForm.password=d),d}),i(),t(24,"button",15),c("click",function(){return e.togglePasswordVisibility()}),t(25,"mat-icon",16),n(26),i()()()(),t(27,"div",17)(28,"app-button",18),c("click",function(){return e.login()}),m(29,X,2,0,"span",19)(30,Y,4,0,"span",20),i()(),t(31,"div",21)(32,"button",22),c("click",function(){return e.goToSignUp()}),n(33," \xBFNo tienes cuenta? Reg\xEDstrate "),i(),m(34,Z,2,0,"button",23),t(35,"button",22),c("click",function(){return e.openForgotPasswordModal()}),n(36," \xBFOlvidaste tu contrase\xF1a? Haz clic aqu\xED. "),i()()()()()()),o&2&&(a(8),g(e.userType==="physiotherapist"?"medical_services":"favorite"),a(2),k(" ",e.userType==="physiotherapist"?"Fisioterapeuta":"Paciente"," "),a(8),f("ngModel",e.loginForm.email),l("disabled",e.isLoading),a(5),l("type",e.showPassword?"text":"password"),f("ngModel",e.loginForm.password),l("disabled",e.isLoading),a(),l("disabled",e.isLoading),a(2),g(e.showPassword?"visibility_off":"visibility"),a(2),l("disabled",e.isLoading||!e.loginForm.email||!e.loginForm.password),a(),l("ngIf",!e.isLoading),a(),l("ngIf",e.isLoading),a(4),l("ngIf",e.showUnlockLink))},dependencies:[T,L,j,D,U,R,I,G,H,z,A,O,V,B,N,W],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};export{Q as LoginComponent};
