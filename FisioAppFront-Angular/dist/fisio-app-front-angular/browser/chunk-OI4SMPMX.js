import{a as te}from"./chunk-CPCDOBUO.js";import{a as ie}from"./chunk-XSANDTBY.js";import{a as U}from"./chunk-T3SLRWRV.js";import"./chunk-ZQHCER67.js";import{a as Y}from"./chunk-X3IRCCKU.js";import{b as k,d as A,f as j,h as B,n as O,o as H,s as z}from"./chunk-BKO5ELJN.js";import{b as q,c as G,d as J,e as K,f as Q}from"./chunk-AXJP532N.js";import"./chunk-MIONVMI7.js";import{c as $,e as ee}from"./chunk-BV64I7NB.js";import"./chunk-Y2M3SQ4J.js";import{Ba as i,Bb as L,C as _,Ca as o,Ea as T,Fa as P,Gb as V,Ha as N,Ja as h,Jb as W,Ka as f,Lb as I,Ob as D,P as y,Pb as x,Q as b,Ta as s,Ua as w,Va as C,Ya as p,Za as m,_a as u,a as v,b as M,da as l,g as S,ha as g,la as E,pa as F,pc as X,qc as Z,ta as d,vb as R}from"./chunk-OSJLVL2X.js";function re(c,a){if(c&1){let r=N();T(0),i(1,"div",10)(2,"label",11),s(3,"N\xFAmero de Licencia"),o(),i(4,"input",27),u("ngModelChange",function(n){y(r);let t=f();return m(t.physioForm.licenseNumber,n)||(t.physioForm.licenseNumber=n),b(n)}),o()(),i(5,"div",10)(6,"label",11),s(7,"Autoridad de Emisi\xF3n"),o(),i(8,"input",28),u("ngModelChange",function(n){y(r);let t=f();return m(t.physioForm.licenseAuthority,n)||(t.physioForm.licenseAuthority=n),b(n)}),o()(),i(9,"div",10)(10,"label",11),s(11,"A\xF1o de Graduaci\xF3n"),o(),i(12,"input",29),u("ngModelChange",function(n){y(r);let t=f();return m(t.physioForm.graduationYear,n)||(t.physioForm.graduationYear=n),b(n)}),o(),i(13,"p",15),s(14),o()(),i(15,"div",10)(16,"label",11),s(17,"Especialidades (separadas por comas)"),o(),i(18,"textarea",30),u("ngModelChange",function(n){y(r);let t=f();return m(t.specialtiesText,n)||(t.specialtiesText=n),b(n)}),o(),i(19,"p",15),s(20,"Se requiere al menos una especialidad"),o()(),P()}if(c&2){let r=f();l(4),p("ngModel",r.physioForm.licenseNumber),d("disabled",r.isLoading),l(4),p("ngModel",r.physioForm.licenseAuthority),d("disabled",r.isLoading),l(4),p("ngModel",r.physioForm.graduationYear),d("min",1950)("max",r.currentYear)("disabled",r.isLoading),l(2),C("Debe estar entre 1950 y ",r.currentYear,""),l(4),p("ngModel",r.specialtiesText),d("disabled",r.isLoading)}}function ne(c,a){c&1&&(i(0,"span"),s(1,"Crear Cuenta"),o())}function ae(c,a){c&1&&(i(0,"span",31)(1,"mat-icon",32),s(2,"refresh"),o(),s(3," Cargando... "),o())}var oe=class c{constructor(a,r,e,n,t){this.toastService=a;this.router=r;this.route=e;this.http=n;this.dialog=t}userType="patient";currentYear=new Date().getFullYear();patientForm={email:"",password:"",confirmPassword:"",fullName:"",telefono:"",fechaNacimiento:""};physioForm={email:"",password:"",confirmPassword:"",fullName:"",telefono:"",fechaNacimiento:"",licenseNumber:"",licenseAuthority:"",graduationYear:new Date().getFullYear(),specialties:[]};specialtiesText="";isLoading=!1;showPassword=!1;destroy$=new S;ngOnInit(){this.route.data.subscribe(a=>{this.userType=a.userType||"patient"})}register(){if(!this.isFormValid()){this.toastService.warning("Por favor completa todos los campos correctamente");return}if(!this.isValidEmail(this.patientForm.email)){this.toastService.error("El correo electr\xF3nico no es v\xE1lido");return}if(this.patientForm.password!==this.patientForm.confirmPassword){this.toastService.error("Las contrase\xF1as no coinciden");return}if(this.userType==="physiotherapist"){let a=new Date().getFullYear();if(this.physioForm.graduationYear<1950||this.physioForm.graduationYear>a){this.toastService.error(`El a\xF1o de graduaci\xF3n debe estar entre 1950 y ${a}`);return}if(this.specialtiesText.split(",").map(e=>e.trim()).filter(e=>e.length>0).length===0){this.toastService.error("Se requiere al menos una especialidad");return}}this.isLoading=!0,this.userType==="physiotherapist"?(this.physioForm.email=this.patientForm.email,this.physioForm.password=this.patientForm.password,this.physioForm.fullName=this.patientForm.fullName,this.physioForm.telefono=this.patientForm.telefono,this.physioForm.fechaNacimiento=this.patientForm.fechaNacimiento?new Date(this.patientForm.fechaNacimiento).toISOString():void 0,this.physioForm.specialties=this.specialtiesText.split(",").map(a=>a.trim()).filter(a=>a.length>0),this.http.post(`${x.apiUrl}/api/physiotherapists/register`,this.physioForm).pipe(_(this.destroy$)).subscribe({next:a=>{this.isLoading=!1,this.openVerifyEmailModal()},error:a=>{this.isLoading=!1;let r=a.error?.error||"Error al crear la cuenta";this.toastService.error(r)}})):this.http.post(`${x.apiUrl}/api/auth/register`,M(v({},this.patientForm),{fechaNacimiento:this.patientForm.fechaNacimiento?new Date(this.patientForm.fechaNacimiento).toISOString():null})).pipe(_(this.destroy$)).subscribe({next:a=>{this.isLoading=!1,this.openVerifyEmailModal()},error:a=>{this.isLoading=!1;let r=a.error?.error||"Error al crear la cuenta";this.toastService.error(r)}})}isFormValid(){let a=/^\+?[0-9\s\-()]{10,}$/.test(this.patientForm.telefono?.trim()||"");if(this.userType==="physiotherapist"){let r=new Date().getFullYear(),e=this.physioForm.graduationYear>=1950&&this.physioForm.graduationYear<=r,n=this.specialtiesText.split(",").map(t=>t.trim()).filter(t=>t.length>0);return!!(this.patientForm.fullName&&this.patientForm.email&&this.isValidEmail(this.patientForm.email)&&this.patientForm.password&&this.patientForm.confirmPassword&&a&&this.physioForm.licenseNumber&&this.physioForm.licenseAuthority&&e&&n.length>0)}else return!!(this.patientForm.fullName&&this.patientForm.email&&this.isValidEmail(this.patientForm.email)&&this.patientForm.password&&this.patientForm.confirmPassword&&a)}isValidEmail(a){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)}togglePasswordVisibility(){this.showPassword=!this.showPassword}goToLogin(){let a=this.userType==="physiotherapist"?"/login/physiotherapist":"/login/patient";this.router.navigate([a])}goToHome(){this.router.navigate(["/"])}openVerifyEmailModal(){this.dialog.open(ie,{width:"500px",disableClose:!0,data:{email:this.patientForm.email,userType:this.userType}}).afterClosed().subscribe(r=>{if(r==="navigate-to-login"){let e=this.userType==="physiotherapist"?"/login/physiotherapist":"/login/patient";this.router.navigate([e])}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(r){return new(r||c)(g(Y),g(I),g(W),g(V),g($))};static \u0275cmp=E({type:c,selectors:[["app-register"]],decls:57,vars:24,consts:[[1,"min-h-screen","bg-gradient-to-br","from-background","via-background","to-muted/20","flex","items-center","justify-center","p-4"],[1,"w-full","max-w-md","shadow-xl","relative"],["type","button","title","Volver a inicio",1,"absolute","top-4","left-4","p-2","text-muted-foreground","hover:text-foreground","transition-colors","rounded-md","hover:bg-muted/50","z-10",3,"click"],[1,"h-6","w-6"],[1,"space-y-2","pb-6"],[1,"flex","items-center","justify-center","gap-2","mb-4"],[1,"h-8","w-8","text-primary"],[1,"text-2xl"],[1,"text-center","text-base"],[1,"space-y-6"],[1,"space-y-2"],[1,"text-sm","font-medium","text-foreground"],["type","text","placeholder","Tu nombre",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],["type","email","placeholder","tu@correo.com",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],["type","tel","placeholder","+1 (555) 123-4567 o 555-123-4567",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-muted-foreground"],["type","date",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],[4,"ngIf"],[1,"relative"],["placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-3","py-2","pr-10","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","type","ngModel","disabled"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-muted-foreground","hover:text-foreground","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"!size-5"],[1,"flex","justify-center","pt-2"],["size","lg",1,"px-12",3,"click","disabled"],["class","flex items-center gap-2",4,"ngIf"],[1,"space-y-3","pt-4","border-t","border-border"],["type","button",1,"w-full","text-sm","text-primary","hover:underline","transition-colors","text-center",3,"click"],["type","text","placeholder","Tu n\xFAmero de licencia",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Ej: Colegio Profesional",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","disabled"],["type","number","placeholder","Ej: 2020",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"ngModelChange","ngModel","min","max","disabled"],["placeholder","Ej: Fisioterapia deportiva, Rehabilitaci\xF3n","rows","3",1,"w-full","px-3","py-2","rounded-md","border","border-input","bg-transparent","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-1","focus:ring-ring","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","resize-none",3,"ngModelChange","ngModel","disabled"],[1,"flex","items-center","gap-2"],[1,"animate-spin","!size-4"]],template:function(r,e){r&1&&(i(0,"div",0)(1,"app-card",1)(2,"button",2),h("click",function(){return e.goToHome()}),i(3,"mat-icon",3),s(4,"arrow_back"),o()(),i(5,"app-card-header",4)(6,"div",5)(7,"mat-icon",6),s(8),o(),i(9,"app-card-title",7),s(10),o()(),i(11,"app-card-description",8),s(12," Crea tu cuenta "),o()(),i(13,"app-card-content")(14,"div",9)(15,"div",10)(16,"label",11),s(17,"Nombre Completo"),o(),i(18,"input",12),u("ngModelChange",function(t){return m(e.patientForm.fullName,t)||(e.patientForm.fullName=t),t}),o()(),i(19,"div",10)(20,"label",11),s(21,"Correo Electr\xF3nico"),o(),i(22,"input",13),u("ngModelChange",function(t){return m(e.patientForm.email,t)||(e.patientForm.email=t),t}),o()(),i(23,"div",10)(24,"label",11),s(25,"N\xFAmero de Tel\xE9fono"),o(),i(26,"input",14),u("ngModelChange",function(t){return m(e.patientForm.telefono,t)||(e.patientForm.telefono=t),t}),o(),i(27,"p",15),s(28,"M\xEDnimo 10 d\xEDgitos, puede incluir +, -, () o espacios"),o()(),i(29,"div",10)(30,"label",11),s(31,"Fecha de Nacimiento"),o(),i(32,"input",16),u("ngModelChange",function(t){return m(e.patientForm.fechaNacimiento,t)||(e.patientForm.fechaNacimiento=t),t}),o()(),F(33,re,21,11,"ng-container",17),i(34,"div",10)(35,"label",11),s(36,"Contrase\xF1a"),o(),i(37,"div",18)(38,"input",19),u("ngModelChange",function(t){return m(e.patientForm.password,t)||(e.patientForm.password=t),t}),o(),i(39,"button",20),h("click",function(){return e.togglePasswordVisibility()}),i(40,"mat-icon",21),s(41),o()()()(),i(42,"div",10)(43,"label",11),s(44,"Confirmar Contrase\xF1a"),o(),i(45,"div",18)(46,"input",19),u("ngModelChange",function(t){return m(e.patientForm.confirmPassword,t)||(e.patientForm.confirmPassword=t),t}),o(),i(47,"button",20),h("click",function(){return e.togglePasswordVisibility()}),i(48,"mat-icon",21),s(49),o()()()(),i(50,"div",22)(51,"app-button",23),h("click",function(){return e.register()}),F(52,ne,2,0,"span",17)(53,ae,4,0,"span",24),o()(),i(54,"div",25)(55,"button",26),h("click",function(){return e.goToLogin()}),s(56," \xBFYa tienes cuenta? Inicia sesi\xF3n "),o()()()()()()),r&2&&(l(8),w(e.userType==="physiotherapist"?"medical_services":"favorite"),l(2),C(" ",e.userType==="physiotherapist"?"Registro Fisioterapeuta":"Registro Paciente"," "),l(8),p("ngModel",e.patientForm.fullName),d("disabled",e.isLoading),l(4),p("ngModel",e.patientForm.email),d("disabled",e.isLoading),l(4),p("ngModel",e.patientForm.telefono),d("disabled",e.isLoading),l(6),p("ngModel",e.patientForm.fechaNacimiento),d("disabled",e.isLoading),l(),d("ngIf",e.userType==="physiotherapist"),l(5),d("type",e.showPassword?"text":"password"),p("ngModel",e.patientForm.password),d("disabled",e.isLoading),l(),d("disabled",e.isLoading),l(2),w(e.showPassword?"visibility_off":"visibility"),l(5),d("type",e.showPassword?"text":"password"),p("ngModel",e.patientForm.confirmPassword),d("disabled",e.isLoading),l(),d("disabled",e.isLoading),l(2),w(e.showPassword?"visibility_off":"visibility"),l(2),d("disabled",e.isLoading||!e.isFormValid()),l(),d("ngIf",!e.isLoading),l(),d("ngIf",e.isLoading))},dependencies:[L,R,z,k,B,A,H,O,j,D,ee,Z,X,te,U,q,G,J,K,Q],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};export{oe as RegisterComponent};
