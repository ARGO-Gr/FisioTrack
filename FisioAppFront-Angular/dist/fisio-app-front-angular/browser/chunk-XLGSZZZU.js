import"./chunk-M5DJHSQB.js";import{a as W}from"./chunk-GTJQTBRL.js";import"./chunk-TCFNCYFJ.js";import"./chunk-NFK4ZOSM.js";import"./chunk-LF2MMEF2.js";import"./chunk-5KHLW6S3.js";import"./chunk-SSZJWXNS.js";import"./chunk-JNA6BDWN.js";import"./chunk-WXQHLAO7.js";import"./chunk-LEDDZPP6.js";import"./chunk-B7RCBSHE.js";import{a as Q}from"./chunk-7T7MBVYG.js";import{a as $}from"./chunk-OX3AEPKD.js";import{s as H}from"./chunk-2SYUDXM5.js";import{a as K}from"./chunk-TCB6RIUV.js";import{b as R,f as B}from"./chunk-CO7GZ2GE.js";import{j as J}from"./chunk-ILFOJNPL.js";import{a as O}from"./chunk-O7IYFQTM.js";import"./chunk-FXDBWEGB.js";import{c as G,e as q}from"./chunk-IJ4FMSKR.js";import"./chunk-5HGQTLS2.js";import{Ba as n,Bb as N,C as h,Ca as a,Da as y,Ha as S,Ja as C,Ka as p,Lb as j,P as f,Q as g,Sa as M,Ta as o,Ua as v,Va as E,a as F,ab as k,b as P,da as c,g as A,ha as x,hb as L,la as I,pa as u,pc as z,qc as U,ta as d,tb as T,ub as D,va as _,vb as V}from"./chunk-3JF2NBPF.js";var Z=()=>[1,2,3];function ee(r,i){if(r&1&&(n(0,"span",44),o(1),a()),r&2){let t=p().$implicit,e=p(2);d("ngClass","px-3 py-1 rounded-full text-sm font-medium "+e.getEstadoBadgeClass(t)),c(),E(" ",e.getEstadoText(t)," ")}}function te(r,i){r&1&&(n(0,"p",29),o(1,"Cita con tu fisioterapeuta"),a())}function ie(r,i){if(r&1){let t=S();n(0,"button",45),C("click",function(){f(t);let s=p().$implicit,l=p(2);return g(l.openConfirmModal(s))}),n(1,"mat-icon"),o(2,"check_circle"),a(),o(3," Confirmar "),a()}}function ae(r,i){if(r&1){let t=S();n(0,"button",46),C("click",function(){f(t);let s=p().$implicit,l=p(2);return g(l.openCancelConfirm(s))}),n(1,"mat-icon"),o(2,"cancel"),a(),o(3," Cancelar "),a()}}function ne(r,i){if(r&1&&(n(0,"div",25)(1,"div",47)(2,"mat-icon",48),o(3,"attach_money"),a()(),n(4,"div")(5,"p",28),o(6,"Precio"),a(),n(7,"p",49),o(8),a()()()),r&2){let t=p().$implicit,e=p(2);c(8),v(e.formatearMonto(t.monto))}}function oe(r,i){if(r&1&&(n(0,"div",50)(1,"mat-icon",51),o(2,"note"),a(),n(3,"div")(4,"p",52),o(5,"Descripci\xF3n"),a(),n(6,"p",29),o(7),a()()()),r&2){let t=p().$implicit;c(7),v(t.descripcion)}}function re(r,i){if(r&1&&(n(0,"div",13)(1,"div",14)(2,"div",15)(3,"div",16)(4,"div",17)(5,"h3",18),o(6),a(),u(7,ee,2,2,"span",19),a(),u(8,te,2,0,"p",20),a(),n(9,"div",21),u(10,ie,4,0,"button",22)(11,ae,4,0,"button",23),a()()(),n(12,"div",11)(13,"div",24)(14,"div",25)(15,"div",26)(16,"mat-icon",27),o(17,"calendar_today"),a()(),n(18,"div")(19,"p",28),o(20,"Fecha"),a(),n(21,"p",29),o(22),a()()(),n(23,"div",25)(24,"div",30)(25,"mat-icon",31),o(26,"schedule"),a()(),n(27,"div")(28,"p",28),o(29,"Hora"),a(),n(30,"p",29),o(31),a()()(),n(32,"div",25)(33,"div",32)(34,"mat-icon",33),o(35,"info"),a()(),n(36,"div")(37,"p",28),o(38,"Tipo"),a(),n(39,"p",29),o(40),a()()(),u(41,ne,9,1,"div",34),a(),n(42,"div",35)(43,"p",36),o(44,"Estados de la Cita"),a(),n(45,"div",37)(46,"div",38)(47,"p",39),o(48,"Fisio:"),a(),n(49,"div",40),y(50,"div",41),n(51,"p",42),o(52),a()()(),n(53,"div",38)(54,"p",39),o(55,"Paciente:"),a(),n(56,"div",40),y(57,"div",41),n(58,"p",42),o(59),a()()()()(),u(60,oe,8,1,"div",43),a()()),r&2){let t=i.$implicit,e=p(2);d("ngClass",e.getCitaColor(t)),c(6),v(t.descripcion),c(),d("ngIf",e.filtroActivo!=="pagadas"),c(),d("ngIf",e.filtroActivo!=="pagadas"),c(2),d("ngIf",e.puedeConfirmar(t)&&e.filtroActivo!=="pasadas"&&!e.esCitaCanceladaPasada(t)),c(),d("ngIf",e.puedeCancelar(t)&&e.filtroActivo!=="pasadas"&&!e.esCitaCanceladaPasada(t)),c(2),d("ngClass",e.filtroActivo==="pagadas"?"grid-cols-1 md:grid-cols-4":"grid-cols-1 md:grid-cols-3"),c(9),v(e.formatDate(t.fecha)),c(9),v(t.hora),c(9),v(t.tipo),c(),d("ngIf",e.filtroActivo==="pagadas"),c(9),d("ngClass",e.getColorFisio(t.estadoFisio)),c(2),v(t.estadoFisio),c(5),d("ngClass",e.getColorPaciente(t.estadoPaciente)),c(2),v(t.estadoPaciente),c(),d("ngIf",t.descripcion)}}function se(r,i){if(r&1&&(n(0,"div",11),u(1,re,61,16,"div",12),a()),r&2){let t=p();c(),d("ngForOf",t.citasFiltradas)}}function ce(r,i){if(r&1&&(n(0,"app-card",53)(1,"div",54)(2,"mat-icon",55),o(3," event_busy "),a(),n(4,"p",56),o(5),a()()()),r&2){let t=p();c(5),E(" ",t.filtroActivo==="proximas"?"No tienes citas pr\xF3ximas programadas":t.filtroActivo==="pasadas"?"No tienes citas pasadas":t.filtroActivo==="pagadas"?"No tienes citas pagadas":"No tienes citas canceladas"," ")}}function de(r,i){r&1&&(n(0,"app-card",58),y(1,"app-card-content",59),a())}function le(r,i){r&1&&(n(0,"div",11),u(1,de,2,0,"app-card",57),a()),r&2&&(c(),d("ngForOf",k(1,Z)))}var X=class r{constructor(i,t,e,s,l,m){this.authService=i;this.appointmentService=t;this.paymentService=e;this.router=s;this.dialog=l;this.toastService=m}navLinks=[{label:"Dashboard",route:"/paciente/dashboard"},{label:"Mi Rutina",route:"/paciente/rutinas"},{label:"Mis Citas",route:"/paciente/citas"},{label:"Pagos",route:"/paciente/pagos-pendientes"}];filtroActivo="proximas";todasLasCitas=[];citasFiltradas=[];cargando=!0;pacienteId="";destroy$=new A;ngOnInit(){let i=this.authService.getUserId();i?(this.pacienteId=i,this.cargarCitas()):(this.toastService.error("No se pudo obtener tu ID"),this.router.navigate(["/"]))}cargarCitas(){this.cargando=!0,this.appointmentService.getAppointmentsByPatient(this.pacienteId).pipe(h(this.destroy$)).subscribe({next:i=>{this.todasLasCitas=i,this.aplicarFiltro(),this.cargando=!1},error:i=>{console.error("Error cargando citas:",i),this.toastService.error("Error al cargar las citas"),this.todasLasCitas=[],this.citasFiltradas=[],this.cargando=!1}})}cambiarFiltro(i){this.filtroActivo=i,this.aplicarFiltro()}aplicarFiltro(){let i=new Date;i.setHours(0,0,0,0),this.filtroActivo==="proximas"?this.citasFiltradas=this.todasLasCitas.filter(t=>{let e=t.estadoFisio?.toLowerCase(),s=t.estadoPaciente?.toLowerCase(),[l,m,w]=t.fecha.split("-").map(Number),b=new Date(l,m-1,w);return b.setHours(0,0,0,0),b>=i&&(e==="pendiente"||e==="confirmadofisio"||s==="confirmadopaciente")&&e!=="canceladafisio"&&s!=="canceladapaciente"}):this.filtroActivo==="canceladas"?this.citasFiltradas=this.todasLasCitas.filter(t=>{let e=t.estadoFisio?.toLowerCase(),s=t.estadoPaciente?.toLowerCase();return e==="canceladafisio"||s==="canceladapaciente"}):this.filtroActivo==="pasadas"?this.citasFiltradas=this.todasLasCitas.filter(t=>{let e=t.estadoFisio?.toLowerCase(),s=t.estadoPaciente?.toLowerCase(),[l,m,w]=t.fecha.split("-").map(Number),b=new Date(l,m-1,w);return b.setHours(0,0,0,0),b<i&&(e==="pendiente"||e==="confirmadofisio"||s==="confirmadopaciente")&&e!=="canceladafisio"&&s!=="canceladapaciente"}):this.filtroActivo==="pagadas"&&this.cargarCitasPagadas()}cargarCitasPagadas(){this.cargando=!0,this.paymentService.getAllPaymentsByPatient().pipe(h(this.destroy$)).subscribe({next:i=>{let t=i.filter(s=>!s.isPendingPayment),e=[];for(let s of t){let l=this.todasLasCitas.find(m=>m.id===s.appointmentId);l&&e.push(P(F({},l),{monto:s.monto}))}this.citasFiltradas=e,this.cargando=!1},error:i=>{console.error("Error cargando citas pagadas:",i),this.citasFiltradas=[],this.cargando=!1}})}formatearMonto(i){return i?i.toFixed(2):"0.00"}getCitaColor(i){let t=i.estadoFisio?.toLowerCase(),e=i.estadoPaciente?.toLowerCase();return t==="cobrado"?"bg-green-100 border-green-300":t==="cobropendiente"?"bg-orange-100 border-orange-300":t==="canceladafisio"||e==="canceladapaciente"?"bg-red-100 border-red-300":t==="confirmadofisio"&&e==="confirmadopaciente"?"bg-blue-100 border-blue-300":"bg-yellow-100 border-yellow-300"}getEstadoBadgeClass(i){let t=i.estadoFisio?.toLowerCase(),e=i.estadoPaciente?.toLowerCase();return t==="canceladafisio"||e==="canceladapaciente"?"bg-red-100 text-red-700":t==="confirmadofisio"&&e==="confirmadopaciente"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}getEstadoText(i){let t=i.estadoFisio?.toLowerCase(),e=i.estadoPaciente?.toLowerCase();return t==="canceladafisio"||e==="canceladapaciente"?"Cancelada":t==="confirmadofisio"&&e==="confirmadopaciente"?"Confirmada":"Pendiente"}formatDate(i){let[t,e,s]=i.split("-").map(Number);return new Date(t,e-1,s).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}getColorFisio(i){switch(i?.toLowerCase()){case"pendiente":return"bg-yellow-400";case"confirmadofisio":return"bg-blue-400";case"cobrado":return"bg-green-400";case"canceladafisio":return"bg-red-400";default:return"bg-gray-400"}}getColorPaciente(i){switch(i?.toLowerCase()){case"pendiente":return"bg-yellow-400";case"confirmadopaciente":return"bg-blue-400";case"canceladapaciente":return"bg-orange-400";default:return"bg-gray-400"}}esCitaCanceladaPasada(i){if(this.filtroActivo!=="canceladas")return!1;let t=new Date;t.setHours(0,0,0,0);let[e,s,l]=i.fecha.split("-").map(Number),m=new Date(e,s-1,l);return m.setHours(0,0,0,0),m<t}puedeCancelar(i){let t=i.estadoFisio?.toLowerCase(),e=i.estadoPaciente?.toLowerCase();return t!=="canceladafisio"&&e!=="canceladapaciente"&&t!=="cobrado"&&t!=="cobropendiente"}puedeConfirmar(i){let t=i.estadoFisio?.toLowerCase(),e=i.estadoPaciente?.toLowerCase();return t!=="canceladafisio"&&t!=="cobrado"&&t!=="cobropendiente"&&e!=="confirmadopaciente"}openCancelConfirm(i){this.dialog.open(W,{width:"400px",data:{paciente:"Tu cita",fecha:new Date(i.fecha),hora:i.hora}}).afterClosed().subscribe(e=>{e&&this.changeAppointmentStatusPaciente(i.id,"CanceladaPaciente")})}openConfirmModal(i){this.changeAppointmentStatusPaciente(i.id,"ConfirmadoPaciente")}changeAppointmentStatusPaciente(i,t){this.appointmentService.changeAppointmentStatusPaciente(i,t).pipe(h(this.destroy$)).subscribe({next:()=>{this.toastService.success("Estado de cita actualizado exitosamente"),this.cargarCitas()},error:e=>{this.toastService.error(e.error?.message||"Error al actualizar estado de cita"),console.error("Error changing paciente status:",e)}})}onChangeInfo(){console.log("Cambiar informaci\xF3n - pendiente de implementar")}logout(){this.authService.logout()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)(x(O),x(K),x(Q),x(j),x(G),x($))};static \u0275cmp=I({type:r,selectors:[["app-mis-citas"]],decls:21,vars:24,consts:[["noCitas",""],[1,"min-h-screen","bg-background"],[3,"changeInfo","logout","navLinks"],[1,"container","mx-auto","px-4","py-8"],[1,"mb-8"],[1,"text-4xl","font-bold","text-foreground","mb-8"],[1,"text-muted-foreground"],[1,"flex","gap-4","mb-6","border-b","border-border","overflow-x-auto"],[1,"pb-2","px-4","font-semibold","transition-all","whitespace-nowrap",3,"click","ngClass"],["class","space-y-4",4,"ngIf","ngIfElse"],["class","space-y-4",4,"ngIf"],[1,"space-y-4"],["class","p-4 rounded-lg border-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"p-4","rounded-lg","border-2",3,"ngClass"],[1,"mb-4"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-2"],[1,"text-lg","font-semibold","text-foreground"],[3,"ngClass",4,"ngIf"],["class","text-sm text-muted-foreground",4,"ngIf"],[1,"flex","items-center","gap-2","ml-4"],["class","flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors font-medium",3,"click",4,"ngIf"],["class","flex items-center gap-2 px-4 py-2 rounded-lg bg-white border-2 border-red-600 text-red-600 hover:bg-red-50 transition-colors font-medium",3,"click",4,"ngIf"],[1,"grid","gap-4",3,"ngClass"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","bg-primary/10","flex","items-center","justify-center","flex-shrink-0"],[1,"text-primary"],[1,"text-sm","font-medium","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"w-10","h-10","rounded-lg","bg-secondary/10","flex","items-center","justify-center","flex-shrink-0"],[1,"text-secondary"],[1,"w-10","h-10","rounded-lg","bg-accent/10","flex","items-center","justify-center","flex-shrink-0"],[1,"text-accent"],["class","flex items-center gap-3",4,"ngIf"],[1,"mt-4","p-4","rounded-lg","bg-muted/50"],[1,"text-sm","font-semibold","text-foreground","mb-3"],[1,"flex","items-center","gap-6"],[1,"flex","items-center","gap-2"],[1,"text-xs","font-semibold","text-muted-foreground","w-20"],[1,"flex","items-center","gap-1"],[1,"w-4","h-4","rounded-full",3,"ngClass"],[1,"text-xs","text-foreground"],["class","mt-3 p-4 rounded-lg bg-muted/50 flex items-start gap-3",4,"ngIf"],[3,"ngClass"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-blue-600","text-white","hover:bg-blue-700","transition-colors","font-medium",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-white","border-2","border-red-600","text-red-600","hover:bg-red-50","transition-colors","font-medium",3,"click"],[1,"w-10","h-10","rounded-lg","bg-green-100","flex","items-center","justify-center","flex-shrink-0"],[1,"text-green-600"],[1,"text-sm","font-semibold","text-green-600"],[1,"mt-3","p-4","rounded-lg","bg-muted/50","flex","items-start","gap-3"],[1,"text-muted-foreground","mt-0.5"],[1,"text-sm","font-medium","text-foreground","mb-1"],[1,"text-center","p-12"],[1,"flex","flex-col","items-center","justify-center"],[1,"text-muted-foreground","mb-4","opacity-50",2,"font-size","48px","width","48px","height","48px"],[1,"text-muted-foreground","mb-4"],["class","animate-pulse",4,"ngFor","ngForOf"],[1,"animate-pulse"],[1,"h-32"]],template:function(t,e){if(t&1){let s=S();n(0,"div",1)(1,"app-header",2),C("changeInfo",function(){return f(s),g(e.onChangeInfo())})("logout",function(){return f(s),g(e.logout())}),a(),n(2,"main",3)(3,"div",4)(4,"h2",5),o(5,"Mis Citas"),a(),n(6,"p",6),o(7,"Gestiona tus citas con tu fisioterapeuta"),a()(),n(8,"div",7)(9,"button",8),C("click",function(){return f(s),g(e.cambiarFiltro("proximas"))}),o(10," Pr\xF3ximas Citas "),a(),n(11,"button",8),C("click",function(){return f(s),g(e.cambiarFiltro("pasadas"))}),o(12," Citas Pasadas "),a(),n(13,"button",8),C("click",function(){return f(s),g(e.cambiarFiltro("pagadas"))}),o(14," Citas Pagadas "),a(),n(15,"button",8),C("click",function(){return f(s),g(e.cambiarFiltro("canceladas"))}),o(16," Canceladas "),a()(),u(17,se,2,1,"div",9)(18,ce,6,1,"ng-template",null,0,L)(20,le,2,2,"div",10),a()()}if(t&2){let s=M(19);c(),d("navLinks",e.navLinks),c(8),_("border-b-2",e.filtroActivo==="proximas")("border-primary",e.filtroActivo==="proximas"),d("ngClass",e.filtroActivo==="proximas"?"text-primary":"text-muted-foreground"),c(2),_("border-b-2",e.filtroActivo==="pasadas")("border-primary",e.filtroActivo==="pasadas"),d("ngClass",e.filtroActivo==="pasadas"?"text-primary":"text-muted-foreground"),c(2),_("border-b-2",e.filtroActivo==="pagadas")("border-primary",e.filtroActivo==="pagadas"),d("ngClass",e.filtroActivo==="pagadas"?"text-primary":"text-muted-foreground"),c(2),_("border-b-2",e.filtroActivo==="canceladas")("border-primary",e.filtroActivo==="canceladas"),d("ngClass",e.filtroActivo==="canceladas"?"text-primary":"text-muted-foreground"),c(2),d("ngIf",!e.cargando&&e.citasFiltradas.length>0)("ngIfElse",s),c(3),d("ngIf",e.cargando)}},dependencies:[N,T,D,V,H,q,U,z,R,B,J],styles:["[_nghost-%COMP%]{display:block}"]})};export{X as MisCitasComponent};
