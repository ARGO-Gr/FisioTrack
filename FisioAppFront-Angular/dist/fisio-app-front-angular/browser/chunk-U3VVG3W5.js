import"./chunk-3XSGU6YG.js";import"./chunk-RTQRPMK3.js";import"./chunk-T3SLRWRV.js";import{a as N}from"./chunk-YX3Y33SO.js";import{a as j}from"./chunk-X3IRCCKU.js";import"./chunk-BKO5ELJN.js";import{b as D,c as F,d as L,f as M}from"./chunk-AXJP532N.js";import{c as O,j as k}from"./chunk-B6JTRMRK.js";import{a as H}from"./chunk-RWZ5TKRV.js";import"./chunk-MIONVMI7.js";import"./chunk-Y2M3SQ4J.js";import{Ba as i,Bb as I,C as y,Ca as e,Ja as _,Ka as s,Lb as T,Ta as t,Ua as p,Va as l,Wa as f,da as o,db as v,fb as u,g as b,ha as c,la as C,pa as g,pc as $,qc as w,ta as m,tb as h,ub as E,vb as S,yb as P}from"./chunk-OSJLVL2X.js";function z(r,a){r&1&&(i(0,"div",19)(1,"div",20)(2,"mat-icon",21),t(3,"refresh"),e(),i(4,"p",6),t(5,"Cargando cobros..."),e()()())}function A(r,a){r&1&&(i(0,"div",22)(1,"mat-icon",23),t(2,"receipt_long"),e(),i(3,"h3",24),t(4,"No hay cobros registrados"),e(),i(5,"p",6),t(6,"Los cobros que realices aparecer\xE1n aqu\xED"),e()())}function B(r,a){if(r&1&&(i(0,"div")(1,"span",6),t(2,"Fecha Pago:"),e(),i(3,"p",41),t(4),v(5,"date"),e()()),r&2){let n=s().$implicit,d=s(2);o(4),p(u(5,1,d.formatearFechaLocal(n.fechaPago),"dd/MM/yyyy HH:mm"))}}function q(r,a){r&1&&(i(0,"div")(1,"span",6),t(2,"Estado:"),e(),i(3,"p",42),t(4,"Esperando pago del paciente"),e()())}function U(r,a){if(r&1&&(i(0,"div",43)(1,"span",35),t(2,"Pagado:"),e(),t(3),i(4,"span",35),t(5,"Cambio:"),e(),t(6),e()),r&2){let n=s().$implicit;o(3),l(" $",n.montoPagado==null?null:n.montoPagado.toFixed(2)," | "),o(3),l(" $",n.cambio==null?null:n.cambio.toFixed(2)," ")}}function G(r,a){if(r&1&&(i(0,"div",43)(1,"span",35),t(2,"Tarjeta:"),e(),t(3),i(4,"span",35),t(5,"Titular:"),e(),t(6),e()),r&2){let n=s().$implicit;o(3),l(" ****",n.numeroTarjeta," | "),o(3),l(" ",n.titularTarjeta," ")}}function J(r,a){r&1&&(i(0,"div",44)(1,"mat-icon",45),t(2,"info"),e(),i(3,"span",35),t(4,"El paciente a\xFAn no ha completado el pago con tarjeta"),e()())}function K(r,a){if(r&1&&(i(0,"div",46)(1,"span",6),t(2,"Notas:"),e(),i(3,"p",47),t(4),e()()),r&2){let n=s().$implicit;o(4),p(n.notas)}}function Q(r,a){if(r&1&&(i(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"mat-icon",5),t(5,"person"),e(),i(6,"h4",31),t(7),e(),i(8,"span",32)(9,"mat-icon",33),t(10),e(),t(11),e(),i(12,"span",32),t(13),e()(),i(14,"div",34)(15,"div")(16,"span",6),t(17,"Fecha Cita:"),e(),i(18,"p",35),t(19),e()(),i(20,"div")(21,"span",6),t(22,"Fecha Cobro:"),e(),i(23,"p",35),t(24),v(25,"date"),e()(),g(26,B,6,4,"div",36)(27,q,5,0,"div",36),i(28,"div")(29,"span",6),t(30,"Monto:"),e(),i(31,"p",37),t(32),e()()(),g(33,U,7,2,"div",38)(34,G,7,2,"div",38)(35,J,5,0,"div",39)(36,K,5,1,"div",40),e()()()),r&2){let n=a.$implicit,d=s(2);m("ngClass",n.isPendingPayment?"border-orange-300 bg-orange-50":"border-border hover:border-primary"),o(7),p(n.nombrePaciente),o(),m("ngClass",n.isPendingPayment?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"),o(2),l(" ",n.isPendingPayment?"schedule":"check_circle"," "),o(),l(" ",n.isPendingPayment?"Pago Pendiente":"Pagado"," "),o(),m("ngClass",n.metodoPago==="Efectivo"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"),o(),l(" ",n.metodoPago," "),o(6),f("",n.fechaCita," ",n.horaCita,""),o(5),p(u(25,17,d.formatearFechaLocal(n.fechaPago),"dd/MM/yyyy HH:mm")),o(2),m("ngIf",!n.isPendingPayment),o(),m("ngIf",n.isPendingPayment),o(5),l("$",n.monto.toFixed(2),""),o(),m("ngIf",n.metodoPago==="Efectivo"&&!n.isPendingPayment),o(),m("ngIf",n.metodoPago==="Tarjeta"&&!n.isPendingPayment),o(),m("ngIf",n.isPendingPayment),o(),m("ngIf",n.notas)}}function V(r,a){if(r&1&&(i(0,"div",25),g(1,Q,37,20,"div",26),e()),r&2){let n=s();o(),m("ngForOf",n.payments)}}var R=class r{constructor(a,n,d,x){this.paymentService=a;this.authService=n;this.router=d;this.toastService=x}pagadosCount=0;pendientesCount=0;payments=[];cargando=!1;totalRecaudado=0;efectivoCount=0;tarjetaCount=0;navLinks=[{label:"Dashboard",route:"/fisioterapeuta/dashboard"},{label:"Agenda",route:"/fisioterapeuta/agenda"},{label:"Pacientes",route:"/fisioterapeuta/pacientes"},{label:"Historial de Cobros",route:"/fisioterapeuta/historial-cobros"}];destroy$=new b;ngOnInit(){this.cargarCobros()}cargarCobros(){this.cargando=!0,this.paymentService.getPayments().pipe(y(this.destroy$)).subscribe({next:a=>{this.payments=a,this.calcularEstadisticas(),this.cargando=!1},error:a=>{console.error("Error al cargar cobros:",a),this.toastService.error("Error al cargar el historial de cobros"),this.cargando=!1}})}calcularEstadisticas(){this.totalRecaudado=this.payments.filter(a=>!a.isPendingPayment).reduce((a,n)=>a+n.monto,0),this.efectivoCount=this.payments.filter(a=>a.metodoPago==="Efectivo").length,this.tarjetaCount=this.payments.filter(a=>a.metodoPago==="Tarjeta").length,this.pagadosCount=this.payments.filter(a=>!a.isPendingPayment).length,this.pendientesCount=this.payments.filter(a=>a.isPendingPayment).length}formatearFechaLocal(a){if(typeof a=="string"){let d=new Date(a),x=new Date().getTimezoneOffset()*60*1e3;return new Date(d.getTime()-x)}let n=new Date().getTimezoneOffset()*60*1e3;return new Date(a.getTime()-n)}onChangeInfo(){console.log("Cambiar informaci\xF3n - pendiente de implementar")}logout(){this.authService.logout(),this.router.navigate(["/"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(n){return new(n||r)(c(N),c(H),c(T),c(j))};static \u0275cmp=C({type:r,selectors:[["app-historial-cobros"]],decls:63,vars:10,consts:[[1,"min-h-screen","bg-background"],[3,"changeInfo","logout","navLinks"],[1,"container","mx-auto","px-4","py-8"],[1,"mb-8"],[1,"text-4xl","font-bold","mb-2","flex","items-center","gap-2"],[1,"text-primary"],[1,"text-muted-foreground"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6","mb-8"],[1,"p-6"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-muted-foreground","mb-1"],[1,"text-3xl","font-bold"],[1,"text-green-600"],[1,"text-xl","font-bold"],[1,"text-orange-600"],[1,"text-blue-600"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","text-center py-12",4,"ngIf"],["class","space-y-3",4,"ngIf"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center"],[1,"animate-spin","text-4xl","text-primary","mb-2"],[1,"text-center","py-12"],[1,"text-6xl","text-muted-foreground","mb-4"],[1,"text-xl","font-semibold","mb-2"],[1,"space-y-3"],["class","p-4 rounded-lg border transition-colors",3,"ngClass",4,"ngFor","ngForOf"],[1,"p-4","rounded-lg","border","transition-colors",3,"ngClass"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"font-semibold","text-lg"],[1,"px-2","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"text-xs",2,"font-size","14px","width","14px","height","14px"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-3","text-sm","mb-3"],[1,"font-medium"],[4,"ngIf"],[1,"font-bold","text-lg","text-green-600"],["class","text-xs text-muted-foreground bg-muted p-2 rounded",4,"ngIf"],["class","text-xs bg-orange-100 text-orange-800 p-2 rounded border border-orange-300",4,"ngIf"],["class","mt-2 text-sm",4,"ngIf"],[1,"font-medium","text-green-600"],[1,"font-medium","text-orange-600"],[1,"text-xs","text-muted-foreground","bg-muted","p-2","rounded"],[1,"text-xs","bg-orange-100","text-orange-800","p-2","rounded","border","border-orange-300"],[1,"text-xs","align-middle","mr-1",2,"font-size","14px","width","14px","height","14px"],[1,"mt-2","text-sm"],[1,"italic"]],template:function(n,d){n&1&&(i(0,"div",0)(1,"app-header",1),_("changeInfo",function(){return d.onChangeInfo()})("logout",function(){return d.logout()}),e(),i(2,"main",2)(3,"div",3)(4,"h2",4)(5,"mat-icon",5),t(6,"monetization_on"),e(),t(7," Historial de Cobros "),e(),i(8,"p",6),t(9,"Consulta todos los cobros realizados"),e()(),i(10,"div",7)(11,"app-card")(12,"app-card-content",8)(13,"div",9)(14,"div")(15,"p",10),t(16,"Total Cobros"),e(),i(17,"p",11),t(18),e()(),i(19,"mat-icon",5),t(20,"receipt_long"),e()()()(),i(21,"app-card")(22,"app-card-content",8)(23,"div",9)(24,"div")(25,"p",10),t(26,"Total Recaudado"),e(),i(27,"p",11),t(28),e()(),i(29,"mat-icon",12),t(30,"attach_money"),e()()()(),i(31,"app-card")(32,"app-card-content",8)(33,"div",9)(34,"div")(35,"p",10),t(36,"Pagados / Pendientes"),e(),i(37,"p",13)(38,"span",12),t(39),e(),t(40," / "),i(41,"span",14),t(42),e()()(),i(43,"mat-icon",15),t(44,"pending_actions"),e()()()(),i(45,"app-card")(46,"app-card-content",8)(47,"div",9)(48,"div")(49,"p",10),t(50,"Efectivo / Tarjeta"),e(),i(51,"p",13),t(52),e()(),i(53,"mat-icon",15),t(54,"payment"),e()()()()(),i(55,"app-card")(56,"app-card-header")(57,"app-card-title"),t(58,"Lista de Cobros"),e()(),i(59,"app-card-content"),g(60,z,6,0,"div",16)(61,A,7,0,"div",17)(62,V,2,1,"div",18),e()()()()),n&2&&(o(),m("navLinks",d.navLinks),o(17),p(d.payments.length),o(10),l("$",d.totalRecaudado.toFixed(2),""),o(11),p(d.pagadosCount),o(3),p(d.pendientesCount),o(10),f("",d.efectivoCount," / ",d.tarjetaCount,""),o(8),m("ngIf",d.cargando),o(),m("ngIf",!d.cargando&&d.payments.length===0),o(),m("ngIf",!d.cargando&&d.payments.length>0))},dependencies:[I,h,E,S,P,D,F,L,M,w,$,O,k],encapsulation:2})};export{R as HistorialCobrosComponent};
