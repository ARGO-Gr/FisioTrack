import{G as s,Gb as l,J as i,Pb as a,h as n}from"./chunk-3JF2NBPF.js";var c=class o{constructor(e){this.http=e}apiUrl=`${a.apiUrl}/api/auth`;tokenSubject=new n(this.getTokenFromLocalStorage());userRoleSubject=new n(this.extractRoleFromToken());token$=this.tokenSubject.asObservable();userRole$=this.userRoleSubject.asObservable();login(e){return this.http.post(`${this.apiUrl}/login`,e)}confirm(e){return this.http.post(`${this.apiUrl}/confirm`,e)}lockUser(e){return this.http.post(`${this.apiUrl}/lock`,e)}unlockUser(e){return this.http.post(`${this.apiUrl}/unlock`,e)}resendUnlockCode(e){return this.http.post(`${this.apiUrl}/resend-unlock-code`,e)}sendPassword(e){return this.http.post(`${this.apiUrl}/send-password`,e)}setToken(e){localStorage.setItem("auth_token",e),this.tokenSubject.next(e);let t=this.extractRoleFromToken(e);this.userRoleSubject.next(t)}getToken(){let e=this.getTokenFromLocalStorage();return e?(this.tokenSubject.value!==e&&this.tokenSubject.next(e),e):this.tokenSubject.value}getToken$(){return this.tokenSubject.asObservable()}getUserId(){try{let e=this.getTokenFromLocalStorage();return e&&this.decodeToken(e)?.sub||null}catch(e){return console.error("Error extrayendo ID del usuario:",e),null}}getUserRole(){return this.userRoleSubject.value}getUserRole$(){return this.userRoleSubject.asObservable()}extractRoleFromToken(e){try{let t=e||this.getTokenFromLocalStorage();if(!t)return null;let r=this.decodeToken(t);return r&&r.role?r.role:null}catch(t){return console.error("Error extrayendo rol del token:",t),null}}decodeToken(e){try{let t=e.split(".");return t.length!==3?(console.error("Token JWT inv\xE1lido"),null):JSON.parse(atob(t[1]))}catch(t){return console.error("Error al decodificar token:",t),null}}hasRole(e){return this.getUserRole()===e}isTokenExpired(){try{let e=this.getTokenFromLocalStorage();if(!e)return!0;let t=this.decodeToken(e);return!t||!t.exp?!0:new Date(t.exp*1e3)<=new Date}catch{return!0}}getTokenFromLocalStorage(){return typeof window<"u"?localStorage.getItem("auth_token"):null}logout(){localStorage.removeItem("auth_token"),localStorage.clear(),this.tokenSubject.next(null),this.userRoleSubject.next(null),sessionStorage.clear(),typeof window<"u"&&(window.location.href="/")}isAuthenticated(){return!!this.getToken()&&!this.isTokenExpired()}static \u0275fac=function(t){return new(t||o)(i(l))};static \u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a};
