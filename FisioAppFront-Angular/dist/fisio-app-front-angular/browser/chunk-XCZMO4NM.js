import"./chunk-3XSGU6YG.js";import{a as C,b as q,c as K,d as Q}from"./chunk-M5DJHSQB.js";import{a as Y}from"./chunk-GTJQTBRL.js";import"./chunk-TCFNCYFJ.js";import"./chunk-KVZLUUDF.js";import"./chunk-NFK4ZOSM.js";import"./chunk-LF2MMEF2.js";import"./chunk-5KHLW6S3.js";import"./chunk-SSZJWXNS.js";import"./chunk-JNA6BDWN.js";import{a as J}from"./chunk-WXQHLAO7.js";import{c as G}from"./chunk-LEDDZPP6.js";import"./chunk-B7RCBSHE.js";import"./chunk-7T7MBVYG.js";import{a as $}from"./chunk-OX3AEPKD.js";import"./chunk-2SYUDXM5.js";import{a as W}from"./chunk-TCB6RIUV.js";import{b as H,c as R,d as V,f as j}from"./chunk-CO7GZ2GE.js";import{c as U,j as B}from"./chunk-ILFOJNPL.js";import{a as L}from"./chunk-O7IYFQTM.js";import"./chunk-FXDBWEGB.js";import{c as O}from"./chunk-IJ4FMSKR.js";import"./chunk-5HGQTLS2.js";import{Ba as r,Bb as M,C as p,Ca as n,Da as _,Ha as x,Ja as g,Ka as d,Lb as P,P as h,Q as f,Ta as a,Ua as u,Va as A,da as s,db as w,fb as E,g as y,ha as b,la as D,pa as v,pc as N,qc as z,ta as m,tb as I,ub as F,vb as k,yb as T}from"./chunk-3JF2NBPF.js";function Z(l,e){if(l&1){let t=x();r(0,"div",24),g("click",function(){h(t);let o=d().$implicit,c=d();return f(c.openScheduleModal(o.hora))}),r(1,"p",25)(2,"mat-icon",26),a(3,"add_circle"),n(),a(4," Horario disponible "),n()()}}function ee(l,e){l&1&&(r(0,"div",27)(1,"p",25),a(2,"Horario disponible"),n()())}function te(l,e){if(l&1){let t=x();r(0,"button",44),g("click",function(){h(t);let o=d(2).$implicit,c=d();return f(c.onCharge(o.cita))}),r(1,"mat-icon"),a(2,"monetization_on"),n()()}}function ie(l,e){if(l&1){let t=x();r(0,"div",28)(1,"div",20)(2,"div",29)(3,"mat-icon",30),a(4,"person"),n(),r(5,"div",20)(6,"h4",31),a(7),n(),r(8,"p",32),a(9),n()()(),r(10,"div",33)(11,"mat-icon",34),a(12,"phone"),n(),r(13,"p",35),a(14),n()(),r(15,"div",36)(16,"div",37)(17,"p",38),a(18,"Fisio:"),n(),r(19,"div",39),_(20,"div",40),r(21,"p",35),a(22),n()()(),r(23,"div",37)(24,"p",38),a(25,"Paciente:"),n(),r(26,"div",39),_(27,"div",40),r(28,"p",35),a(29),n()()()()(),r(30,"div",37),v(31,te,3,0,"button",41),r(32,"app-speed-dial-states",42),g("confirm",function(){h(t);let o=d().$implicit,c=d();return f(c.openConfirmModal(o.cita))})("cancel",function(){h(t);let o=d().$implicit,c=d();return f(c.openCancelConfirm(o.cita))}),n(),r(33,"app-speed-dial",43),g("edit",function(){h(t);let o=d().$implicit,c=d();return f(c.openEditModal(o.cita))})("delete",function(){h(t);let o=d().$implicit,c=d();return f(c.openDeleteConfirm(o.cita))}),n()()()}if(l&2){let t=d().$implicit,i=d();m("ngClass",i.getCitaColor(t.cita)),s(7),u(t.cita.nombrePaciente),s(2),u(t.cita.tipo||"Sin tipo"),s(5),u(t.cita.telefonoPaciente||"Sin tel\xE9fono"),s(6),m("ngClass",i.getColorFisio(t.cita.estadoFisio)),s(2),u(t.cita.estadoFisio),s(5),m("ngClass",i.getColorPaciente(t.cita.estadoPaciente)),s(2),u(t.cita.estadoPaciente),s(2),m("ngIf",t.cita.estadoFisio!=="Cobrado"&&t.cita.estadoFisio!=="CobroPendiente")}}function oe(l,e){if(l&1&&(r(0,"div",17)(1,"div",18)(2,"p",19),a(3),n()(),r(4,"div",20),v(5,Z,5,0,"div",21)(6,ee,3,0,"div",22)(7,ie,34,9,"div",23),n()()),l&2){let t=e.$implicit,i=d();s(3),u(t.hora),s(2),m("ngIf",!t.cita&&!i.isPast()),s(),m("ngIf",!t.cita&&i.isPast()),s(),m("ngIf",t.cita)}}var X=class l{constructor(e,t,i,o,c){this.appointmentService=e;this.authService=t;this.router=i;this.dialog=o;this.toastService=c}selectedDate=new Date;todayString=this.getTodayString();horarios=[];destroy$=new y;isLoading=!1;navLinks=[{label:"Dashboard",route:"/fisioterapeuta/dashboard"},{label:"Agenda",route:"/fisioterapeuta/agenda"},{label:"Pacientes",route:"/fisioterapeuta/pacientes"},{label:"Historial de Cobros",route:"/fisioterapeuta/historial-cobros"}];horasDisponibles=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00"];ngOnInit(){this.appointmentService.test().pipe(p(this.destroy$)).subscribe({next:e=>{console.log("\u2705 API connection test successful:",e),console.log("\u{1F4CB} Current token in localStorage:",this.authService.getTokenFromLocalStorage()),this.appointmentService.debugJwt().pipe(p(this.destroy$)).subscribe({next:t=>{console.log("\u{1F50D} Debug JWT result:",t),this.appointmentService.testAuth().pipe(p(this.destroy$)).subscribe({next:i=>{console.log("\u2705 Auth test successful:",i),this.loadHorarios()},error:i=>{console.error("\u274C Auth test failed:",i),console.error("Status:",i.status),console.error("Error:",i.error),console.error("Token being sent:",this.authService.getTokenFromLocalStorage()),this.toastService.error("Error de autenticaci\xF3n"),this.isLoading=!1}})},error:t=>{console.error("\u274C Debug JWT failed:",t),console.error("Status:",t.status)}})},error:e=>{console.error("\u274C API connection test failed:",e),this.toastService.error("No se pudo conectar con la API"),this.isLoading=!1}})}getTodayString(){return this.getFormattedDate(new Date)}getFormattedDate(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${o}`}loadHorarios(){if(this.isLoading)return;this.isLoading=!0;let e=this.getFormattedDate(this.selectedDate),t=this.authService.getUserId();if(console.log("Loading horarios for:",{fisioterapeutaId:t,fechaStr:e}),!t){console.error("No fisioterapeuta ID available"),this.toastService.error("No se pudo obtener tu ID de usuario"),this.isLoading=!1,this.horarios=this.horasDisponibles.map(i=>({hora:i,disponible:!0}));return}this.appointmentService.getAppointmentsByDay(t,e).pipe(p(this.destroy$)).subscribe({next:i=>{console.log("Appointments loaded:",i),this.horarios=this.horasDisponibles.map(o=>{let c=i.find(S=>S.fecha===e&&S.hora===o);return{hora:o,cita:c,disponible:!c}}),this.isLoading=!1},error:i=>{console.error("Error loading appointments:",i),this.toastService.error("Error al cargar los horarios"),this.isLoading=!1,this.horarios=this.horasDisponibles.map(o=>({hora:o,disponible:!0}))}})}isToday(){let e=new Date;return this.selectedDate.toDateString()===e.toDateString()}isPast(){let e=new Date,t=this.getFormattedDate(e);return this.getFormattedDate(this.selectedDate)<t}getEstadoColor(e){switch(e?.toLowerCase()){case"pendiente":return"bg-yellow-100 border-yellow-300";case"confirmada":return"bg-blue-100 border-blue-300";case"cobrada":return"bg-green-100 border-green-300";case"canceladafisio":return"bg-red-100 border-red-300";case"canceladapaciente":return"bg-orange-100 border-orange-300";default:return"bg-gray-100 border-gray-300"}}getEstadoBadgeClass(e){switch(e?.toLowerCase()){case"pendiente":return"bg-yellow-200 text-yellow-700";case"confirmada":return"bg-blue-200 text-blue-700";case"cobrada":return"bg-green-200 text-green-700";case"canceladafisio":return"bg-red-200 text-red-700";case"canceladapaciente":return"bg-orange-200 text-orange-700";default:return"bg-gray-200 text-gray-700"}}getColorFisio(e){switch(e?.toLowerCase()){case"pendiente":return"bg-yellow-400";case"confirmadofisio":return"bg-blue-400";case"cobrado":return"bg-green-400";case"cobropendiente":return"bg-orange-400";case"canceladafisio":return"bg-red-400";default:return"bg-gray-400"}}getColorPaciente(e){switch(e?.toLowerCase()){case"pendiente":return"bg-yellow-400";case"confirmadopaciente":return"bg-blue-400";case"canceladapaciente":return"bg-orange-400";default:return"bg-gray-400"}}getCitaColor(e){let t=e.estadoFisio?.toLowerCase(),i=e.estadoPaciente?.toLowerCase();return t==="cobrado"?"bg-green-100 border-green-300":t==="cobropendiente"?"bg-orange-100 border-orange-300":t==="canceladafisio"||i==="canceladapaciente"?"bg-red-100 border-red-300":t==="confirmadofisio"&&i==="confirmadopaciente"?"bg-blue-100 border-blue-300":"bg-yellow-100 border-yellow-300"}previousDay(){this.selectedDate.setDate(this.selectedDate.getDate()-1),this.selectedDate=new Date(this.selectedDate),this.loadHorarios()}nextDay(){this.selectedDate.setDate(this.selectedDate.getDate()+1),this.selectedDate=new Date(this.selectedDate),this.loadHorarios()}openCalendar(){this.dialog.open(J,{width:"400px",data:{selectedDate:this.selectedDate}}).afterClosed().subscribe(t=>{t&&(this.selectedDate=new Date(t),this.todayString=this.getFormattedDate(this.selectedDate),this.loadHorarios())})}openScheduleModal(e){let t=this.getFormattedDate(this.selectedDate);this.dialog.open(C,{width:"600px",data:{fecha:t,hora:e}}).afterClosed().subscribe(o=>{o&&this.saveCita(o)})}openEditModal(e){this.dialog.open(C,{width:"600px",data:{cita:{id:e.id,pacienteId:e.pacienteId,fecha:e.fecha,hora:e.hora,descripcion:e.descripcion,estado:e.estado,tipo:e.tipo}}}).afterClosed().subscribe(i=>{i&&this.updateCita(e.id,i)})}openDeleteConfirm(e){this.dialog.open(G,{width:"400px",data:{paciente:e.nombrePaciente,fecha:new Date(e.fecha),hora:e.hora}}).afterClosed().subscribe(i=>{i&&this.deleteCita(e.id)})}openCancelConfirm(e){this.dialog.open(Y,{width:"400px",data:{paciente:e.nombrePaciente,fecha:new Date(e.fecha),hora:e.hora}}).afterClosed().subscribe(i=>{i&&this.changeAppointmentStatusFisio(e.id,"CanceladaFisio")})}openConfirmModal(e){this.changeAppointmentStatusFisio(e.id,"ConfirmadoFisio")}onCharge(e){this.dialog.open(Q,{width:"600px",data:{cita:e}}).afterClosed().subscribe(i=>{i&&this.loadHorarios()})}saveCita(e){let t=this.authService.getUserId();if(!t){this.toastService.error("No se pudo obtener tu ID de usuario");return}let i={fisioterapeutaId:t,pacienteId:e.pacienteId,fecha:e.fecha,hora:e.hora,descripcion:e.descripcion,tipo:e.tipo||"general"};console.log("\u{1F4E4} Enviando cita al backend:",i),this.appointmentService.createAppointment(i).pipe(p(this.destroy$)).subscribe({next:()=>{this.toastService.success("Cita creada exitosamente"),this.loadHorarios()},error:o=>{console.error("\u274C Error details:",{status:o.status,message:o.error?.message,errors:o.error?.errors,body:o.error}),this.toastService.error(o.error?.message||"Error al crear la cita"),console.error("Error creating appointment:",o)}})}updateCita(e,t){let i={pacienteId:t.pacienteId,fecha:t.fecha,hora:t.hora,descripcion:t.descripcion,tipo:t.tipo||"general",estado:t.estado||"pendiente"};this.appointmentService.updateAppointment(e,i).pipe(p(this.destroy$)).subscribe({next:()=>{this.toastService.success("Cita actualizada exitosamente"),this.loadHorarios()},error:o=>{this.toastService.error(o.error?.message||"Error al actualizar la cita"),console.error("Error updating appointment:",o)}})}deleteCita(e){this.appointmentService.deleteAppointment(e).pipe(p(this.destroy$)).subscribe({next:()=>{this.toastService.success("Cita eliminada exitosamente"),this.loadHorarios()},error:t=>{this.toastService.error(t.error?.message||"Error al eliminar la cita"),console.error("Error deleting appointment:",t)}})}changeAppointmentStatus(e,t){this.appointmentService.changeAppointmentStatus(e,t).pipe(p(this.destroy$)).subscribe({next:()=>{this.toastService.success("Estado de cita actualizado exitosamente"),this.loadHorarios()},error:i=>{this.toastService.error(i.error?.message||"Error al actualizar estado de cita"),console.error("Error changing appointment status:",i)}})}changeAppointmentStatusFisio(e,t){this.appointmentService.changeAppointmentStatusFisio(e,t).pipe(p(this.destroy$)).subscribe({next:()=>{this.toastService.success("Estado de fisio actualizado exitosamente"),this.loadHorarios()},error:i=>{this.toastService.error(i.error?.message||"Error al actualizar estado de fisio"),console.error("Error changing fisio status:",i)}})}changeAppointmentStatusPaciente(e,t){this.appointmentService.changeAppointmentStatusPaciente(e,t).pipe(p(this.destroy$)).subscribe({next:()=>{this.toastService.success("Estado de paciente actualizado exitosamente"),this.loadHorarios()},error:i=>{this.toastService.error(i.error?.message||"Error al actualizar estado de paciente"),console.error("Error changing paciente status:",i)}})}onChangeInfo(){console.log("Cambiar informaci\xF3n - pendiente de implementar")}logout(){this.authService.logout(),this.router.navigate(["/"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||l)(b(W),b(L),b(P),b(O),b($))};static \u0275cmp=D({type:l,selectors:[["app-agenda"]],decls:33,vars:8,consts:[[1,"min-h-screen","bg-background"],[3,"changeInfo","logout","navLinks"],[1,"container","mx-auto","px-4","py-8"],[1,"mb-8"],[1,"text-4xl","font-bold","mb-2"],[1,"text-muted-foreground"],[1,"mb-6"],[1,"p-6"],[1,"flex","items-center","justify-between"],[1,"p-2","rounded-lg","hover:bg-muted","transition-colors",3,"click"],[1,"flex-1","text-center"],[1,"flex","items-center","justify-center","gap-2","mb-2","cursor-pointer","group",3,"click"],[1,"text-primary","group-hover:scale-110","transition-transform"],[1,"text-xl","font-semibold","capitalize","group-hover:text-primary","transition-colors"],[1,"text-sm","text-muted-foreground"],[1,"space-y-2","p-4","rounded-lg",3,"ngClass"],["class","flex items-center gap-4",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-4"],[1,"w-20","pt-3"],[1,"text-sm","font-medium","text-muted-foreground"],[1,"flex-1"],["class","p-4 rounded-lg border-2 border-dashed border-border bg-muted/30 hover:bg-muted/50 transition-colors cursor-pointer",3,"click",4,"ngIf"],["class","p-4 rounded-lg border-2 border-dashed border-border bg-muted/50",4,"ngIf"],["class","p-4 rounded-lg border-2 flex items-start justify-between",3,"ngClass",4,"ngIf"],[1,"p-4","rounded-lg","border-2","border-dashed","border-border","bg-muted/30","hover:bg-muted/50","transition-colors","cursor-pointer",3,"click"],[1,"text-sm","text-muted-foreground","text-center"],[1,"text-lg"],[1,"p-4","rounded-lg","border-2","border-dashed","border-border","bg-muted/50"],[1,"p-4","rounded-lg","border-2","flex","items-start","justify-between",3,"ngClass"],[1,"flex","items-start","gap-2","mb-2"],[1,"text-foreground","text-lg"],[1,"font-semibold","text-foreground"],[1,"text-xs","text-muted-foreground"],[1,"flex","items-center","gap-2","ml-6","mb-2"],[1,"text-muted-foreground","text-sm"],[1,"text-xs","text-foreground"],[1,"flex","items-center","gap-4","ml-6"],[1,"flex","items-center","gap-2"],[1,"text-xs","font-semibold","text-muted-foreground"],[1,"flex","items-center","gap-1"],[1,"w-4","h-4","rounded-full",3,"ngClass"],["class","flex items-center justify-center w-10 h-10 rounded-lg hover:bg-green-100 transition-colors text-green-600 hover:text-green-700","title","Cobrar cita",3,"click",4,"ngIf"],[3,"confirm","cancel"],[3,"edit","delete"],["title","Cobrar cita",1,"flex","items-center","justify-center","w-10","h-10","rounded-lg","hover:bg-green-100","transition-colors","text-green-600","hover:text-green-700",3,"click"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"app-header",1),g("changeInfo",function(){return i.onChangeInfo()})("logout",function(){return i.logout()}),n(),r(2,"main",2)(3,"div",3)(4,"h2",4),a(5,"Mi Agenda"),n(),r(6,"p",5),a(7,"Gestiona tus citas y horarios"),n()(),r(8,"app-card",6)(9,"app-card-content",7)(10,"div",8)(11,"button",9),g("click",function(){return i.previousDay()}),r(12,"mat-icon"),a(13,"chevron_left"),n()(),r(14,"div",10)(15,"div",11),g("click",function(){return i.openCalendar()}),r(16,"mat-icon",12),a(17,"calendar_today"),n(),r(18,"h3",13),a(19),w(20,"date"),n()(),r(21,"p",14),a(22),n()(),r(23,"button",9),g("click",function(){return i.nextDay()}),r(24,"mat-icon"),a(25,"chevron_right"),n()()()()(),r(26,"app-card")(27,"app-card-header")(28,"app-card-title"),a(29,"Horario del D\xEDa"),n()(),r(30,"app-card-content")(31,"div",15),v(32,oe,8,4,"div",16),n()()()()()),t&2&&(s(),m("navLinks",i.navLinks),s(18),u(E(20,5,i.selectedDate,"EEEE, d MMMM yyyy")),s(3),A(" ",i.isToday()?"Hoy":i.isPast()?"Fecha pasada":"Fecha futura"," "),s(9),m("ngClass",i.isPast()?"bg-muted/50":"bg-background"),s(),m("ngForOf",i.horarios))},dependencies:[M,I,F,k,T,H,R,V,j,z,N,U,q,K,B],encapsulation:2})};export{X as AgendaComponent};
