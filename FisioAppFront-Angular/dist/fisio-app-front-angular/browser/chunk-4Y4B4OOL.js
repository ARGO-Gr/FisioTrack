import{a as Q,b as X,c as Z,d as ie}from"./chunk-Q3FVKTVV.js";import{a as te}from"./chunk-SSZJWXNS.js";import{b as K}from"./chunk-JNA6BDWN.js";import{a as D}from"./chunk-7T7MBVYG.js";import{a as E}from"./chunk-OX3AEPKD.js";import{b as B,d as H,f as U,q as W,s as q}from"./chunk-2SYUDXM5.js";import{b as ee,c as T,j as ne}from"./chunk-ILFOJNPL.js";import{a as z}from"./chunk-O7IYFQTM.js";import"./chunk-FXDBWEGB.js";import{a as G,b as Y,c as J,e as j}from"./chunk-IJ4FMSKR.js";import"./chunk-5HGQTLS2.js";import{Ba as t,Bb as M,C as P,Ca as e,Ha as _,Ja as x,Ka as c,Lb as $,P as u,Q as f,Sa as O,Ta as i,Ua as g,Va as b,Wa as C,Ya as V,Za as F,_a as N,da as d,g as y,ha as s,hb as R,la as h,pa as v,pc as I,qc as w,ta as m,tb as A,ub as L,vb as S}from"./chunk-3JF2NBPF.js";function ce(a,r){if(a&1&&(t(0,"div",29)(1,"h3",30)(2,"mat-icon",3),i(3,"credit_card"),e(),i(4," Tarjeta de Pago "),e(),t(5,"div",31)(6,"div",32)(7,"div",33)(8,"mat-icon",34),i(9,"credit_card"),e()(),t(10,"div",17)(11,"p",8),i(12),e(),t(13,"p",35),i(14),e()(),t(15,"span",35),i(16),e()()()()),a&2){let n=c();d(7),m("ngClass",n.getCardIconColor(n.tarjetaPredeterminada.cardType)),d(5),g(n.getCardTypeName(n.tarjetaPredeterminada.cardType)),d(2),b("\u2022\u2022\u2022\u2022 ",n.tarjetaPredeterminada.last4,""),d(2),C("Vence ",n.tarjetaPredeterminada.expiryMonth,"/",n.tarjetaPredeterminada.expiryYear,"")}}function ge(a,r){a&1&&(t(0,"div",36)(1,"div",15)(2,"mat-icon",37),i(3,"warning"),e(),t(4,"div",17)(5,"p",38),i(6,"Sin tarjeta predeterminada"),e(),t(7,"p",39),i(8,"Por favor, agrega una tarjeta como predeterminada antes de realizar el pago"),e()()()())}function ue(a,r){if(a&1){let n=_();t(0,"div",40)(1,"div")(2,"label",41)(3,"mat-icon",42),i(4,"password"),e(),i(5," C\xF3digo de Seguridad (CVV) * "),e(),t(6,"input",43),N("ngModelChange",function(l){u(n);let p=c();return F(p.cvv,l)||(p.cvv=l),f(l)}),x("input",function(l){u(n);let p=c();return f(p.validateNumericInput(l))}),e(),t(7,"p",44),i(8,"C\xF3digo de seguridad de 3 o 4 d\xEDgitos que aparece en el reverso de tu tarjeta"),e()()()}if(a&2){let n=c();d(6),V("ngModel",n.cvv)}}function fe(a,r){a&1&&(t(0,"mat-icon"),i(1,"check_circle"),e())}function ve(a,r){a&1&&(t(0,"mat-icon",45),i(1,"refresh"),e())}function xe(a,r){a&1&&(t(0,"span"),i(1,"Confirmar Pago"),e())}function be(a,r){a&1&&(t(0,"span"),i(1,"Procesando..."),e())}var k=class a{constructor(r,n,o,l,p){this.data=r;this.dialogRef=n;this.paymentService=o;this.profileService=l;this.toastService=p;this.pago=r.pago}pago;tarjetaPredeterminada=null;cvv="";procesando=!1;destroy$=new y;ngOnInit(){this.cargarTarjetaPredeterminada()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarTarjetaPredeterminada(){this.profileService.getPaymentCards().pipe(P(this.destroy$)).subscribe({next:r=>{this.tarjetaPredeterminada=r.find(n=>n.isDefault)||null},error:r=>{console.error("Error al cargar tarjetas:",r),this.toastService.error("Error al cargar tu tarjeta predeterminada")}})}validateNumericInput(r){let n=r.target;n.value=n.value.replace(/[^0-9]/g,"")}esValido(){return this.cvv.length>=3&&this.cvv.length<=4}confirmarPago(){if(!this.esValido()||this.procesando||!this.tarjetaPredeterminada)return;this.procesando=!0;let r={numeroTarjeta:this.tarjetaPredeterminada.last4,titularTarjeta:this.tarjetaPredeterminada.cardHolderName,numeroAutorizacion:this.cvv};this.paymentService.confirmPayment(this.pago.id,r).subscribe({next:n=>{this.toastService.success("\xA1Pago procesado exitosamente! Recibir\xE1s un comprobante por correo."),this.dialogRef.close(n)},error:n=>{console.error("Error al procesar el pago:",n),this.toastService.error(n.error?.message||"Error al procesar el pago"),this.procesando=!1}})}getCardTypeName(r){return{Visa:"Visa",Mastercard:"Mastercard",Amex:"American Express",Discover:"Discover"}[r]||r}getCardIconColor(r){return{Visa:"bg-blue-600",Mastercard:"bg-orange-600",Amex:"bg-green-700",Discover:"bg-indigo-600"}[r]||"bg-gray-600"}cerrar(){this.procesando||this.dialogRef.close()}static \u0275fac=function(n){return new(n||a)(s(Y),s(G),s(D),s(ie),s(E))};static \u0275cmp=h({type:a,selectors:[["app-pagar-modal"]],decls:54,vars:13,consts:[["noTarjeta",""],[1,"max-h-[80vh]","overflow-y-auto","p-6"],[1,"text-2xl","font-bold","mb-4","flex","items-center","gap-2"],[1,"text-primary"],[1,"bg-muted","p-4","rounded-lg","mb-6"],[1,"font-semibold","mb-2"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-muted-foreground"],[1,"font-medium"],[1,"col-span-2"],[1,"mt-3","bg-primary/10","p-3","rounded"],[1,"flex","items-center","justify-between"],[1,"font-semibold"],[1,"text-2xl","font-bold","text-primary"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-6"],[1,"flex","items-start","gap-2"],[1,"text-blue-600"],[1,"flex-1"],[1,"text-sm","text-blue-900","font-medium"],[1,"text-xs","text-blue-700"],["class","mb-6 p-4 rounded-lg border border-primary/20 bg-primary/5",4,"ngIf","ngIfElse"],["class","space-y-4",4,"ngIf"],[1,"mt-6","bg-gray-50","p-4","rounded-lg"],[1,"text-xs","text-gray-600"],[1,"flex","justify-end","gap-3","mt-6"],[1,"flex-1","px-4","py-3","rounded-lg","border","border-border","text-foreground","bg-background","hover:bg-muted","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","font-medium",3,"click","disabled"],[1,"flex-1","px-4","py-3","rounded-lg","bg-primary","text-primary-foreground","hover:bg-primary/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","font-medium","flex","items-center","justify-center","gap-2",3,"click","disabled"],[4,"ngIf"],["class","animate-spin",4,"ngIf"],[1,"mb-6","p-4","rounded-lg","border","border-primary/20","bg-primary/5"],[1,"font-semibold","mb-3","flex","items-center","gap-2"],[1,"space-y-2"],[1,"flex","items-center","gap-2","p-3","rounded","bg-white","border","border-border"],[1,"p-2","rounded",3,"ngClass"],[1,"text-white","!size-5"],[1,"text-sm","text-muted-foreground"],[1,"mb-6","p-4","rounded-lg","bg-orange-50","border","border-orange-200"],[1,"text-orange-600"],[1,"text-sm","text-orange-900","font-medium"],[1,"text-xs","text-orange-700"],[1,"space-y-4"],[1,"block","text-sm","font-semibold","text-foreground","mb-3"],[1,"text-primary","align-middle"],["type","password","maxlength","4","placeholder","***",1,"w-full","px-4","py-3","border","border-input","rounded-lg","bg-background","text-foreground","placeholder:text-muted-foreground","focus:outline-none","focus:ring-2","focus:ring-primary","focus:border-transparent","transition-all",3,"ngModelChange","input","ngModel"],[1,"text-xs","text-muted-foreground","mt-2"],[1,"animate-spin"]],template:function(n,o){if(n&1){let l=_();t(0,"div",1)(1,"h2",2)(2,"mat-icon",3),i(3,"credit_card"),e(),i(4," Confirmar Pago con Tarjeta "),e(),t(5,"div",4)(6,"h3",5),i(7,"Detalles del Pago"),e(),t(8,"div",6)(9,"div")(10,"span",7),i(11,"Fecha de Cita:"),e(),t(12,"span",8),i(13),e()(),t(14,"div")(15,"span",7),i(16,"Hora:"),e(),t(17,"span",8),i(18),e()(),t(19,"div",9)(20,"span",7),i(21,"Descripci\xF3n:"),e(),t(22,"span",8),i(23),e()()(),t(24,"div",10)(25,"div",11)(26,"span",12),i(27,"Monto a Pagar:"),e(),t(28,"span",13),i(29),e()()()(),t(30,"div",14)(31,"div",15)(32,"mat-icon",16),i(33,"lock"),e(),t(34,"div",17)(35,"p",18),i(36,"Pago seguro"),e(),t(37,"p",19),i(38,"Tu informaci\xF3n est\xE1 protegida con encriptaci\xF3n de nivel bancario"),e()()()(),v(39,ce,17,5,"div",20)(40,ge,9,0,"ng-template",null,0,R)(42,ue,9,1,"div",21),t(43,"div",22)(44,"p",23),i(45," Al confirmar el pago, aceptas que se realizar\xE1 el cargo por el monto indicado. Recibir\xE1s un comprobante por correo electr\xF3nico una vez completada la transacci\xF3n. "),e()(),t(46,"div",24)(47,"button",25),x("click",function(){return u(l),f(o.cerrar())}),i(48," Cancelar "),e(),t(49,"button",26),x("click",function(){return u(l),f(o.confirmarPago())}),v(50,fe,2,0,"mat-icon",27)(51,ve,2,0,"mat-icon",28)(52,xe,2,0,"span",27)(53,be,2,0,"span",27),e()()()}if(n&2){let l=O(41);d(13),g(o.pago.fechaCita),d(5),g(o.pago.horaCita),d(5),g(o.pago.descripcionCita||"Sin descripci\xF3n"),d(6),b("$",o.pago.monto.toFixed(2),""),d(10),m("ngIf",o.tarjetaPredeterminada)("ngIfElse",l),d(3),m("ngIf",o.tarjetaPredeterminada),d(5),m("disabled",o.procesando),d(2),m("disabled",!o.esValido()||o.procesando||!o.tarjetaPredeterminada),d(),m("ngIf",!o.procesando),d(),m("ngIf",o.procesando),d(),m("ngIf",!o.procesando),d(),m("ngIf",o.procesando)}},dependencies:[M,A,S,q,B,H,W,U,j,w,I,T,K,te],styles:["input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};function _e(a,r){a&1&&(t(0,"div",8)(1,"mat-icon",9),i(2,"refresh"),e(),t(3,"p",10),i(4,"Cargando pagos..."),e()())}function ye(a,r){a&1&&(t(0,"div",8)(1,"mat-icon",11),i(2,"check_circle"),e(),t(3,"h2",12),i(4,"\xA1No tienes pagos pendientes!"),e(),t(5,"p",13),i(6,"Todos tus pagos est\xE1n al d\xEDa"),e()())}function Pe(a,r){if(a&1&&(t(0,"div",34)(1,"p",35)(2,"strong"),i(3,"Nota:"),e(),i(4),e()()),a&2){let n=c().$implicit;d(4),b(" ",n.notas,"")}}function he(a,r){if(a&1){let n=_();t(0,"mat-card",16)(1,"mat-card-content",17)(2,"div",18)(3,"div",19)(4,"div",20)(5,"mat-icon",21),i(6,"pending"),e(),t(7,"div")(8,"h3",22),i(9,"Pago Pendiente"),e(),t(10,"p",23),i(11),e()()(),t(12,"div",24)(13,"div",25)(14,"mat-icon",13),i(15,"description"),e(),t(16,"div")(17,"p",23),i(18,"Descripci\xF3n"),e(),t(19,"p",26),i(20),e()()(),t(21,"div",25)(22,"mat-icon",13),i(23,"calendar_today"),e(),t(24,"div")(25,"p",23),i(26,"Fecha de solicitud"),e(),t(27,"p",26),i(28),e()()()(),v(29,Pe,5,1,"div",27),t(30,"div",28)(31,"div",29)(32,"p",30),i(33,"Monto a pagar"),e(),t(34,"p",31),i(35),e()(),t(36,"button",32),x("click",function(){let l=u(n).$implicit,p=c(2);return f(p.abrirModalPago(l))}),t(37,"mat-icon",33),i(38,"credit_card"),e(),i(39," Pagar Ahora "),e()()()()()()}if(a&2){let n=r.$implicit,o=c(2);d(11),C("",n.fechaCita," - ",n.horaCita,""),d(9),g(n.descripcionCita||"Sin descripci\xF3n"),d(8),g(o.formatDate(n.fechaPago)),d(),m("ngIf",n.notas),d(6),b("$",n.monto.toFixed(2),"")}}function Ce(a,r){if(a&1&&(t(0,"div",14),v(1,he,40,6,"mat-card",15),e()),a&2){let n=c();d(),m("ngForOf",n.pagosPendientes)}}var re=class a{constructor(r,n,o,l,p){this.paymentService=r;this.toastService=n;this.authService=o;this.router=l;this.dialog=p}navLinks=[{label:"Dashboard",route:"/paciente/dashboard"},{label:"Mi Rutina",route:"/paciente/rutinas"},{label:"Mis Citas",route:"/paciente/citas"},{label:"Pagos",route:"/paciente/pagos-pendientes"}];destroy$=new y;pagosPendientes=[];loading=!0;ngOnInit(){this.cargarPagosPendientes()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarPagosPendientes(){this.loading=!0,this.paymentService.getPendingPayments().pipe(P(this.destroy$)).subscribe({next:r=>{this.pagosPendientes=r,this.loading=!1},error:r=>{console.error("Error al cargar pagos pendientes:",r),this.toastService.error("Error al cargar los pagos pendientes"),this.loading=!1}})}abrirModalPago(r){this.dialog.open(k,{width:"500px",data:{pago:r},disableClose:!0}).afterClosed().subscribe(o=>{o&&this.cargarPagosPendientes()})}formatDate(r){return new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}onChangeInfo(){console.log("Cambiar informaci\xF3n - pendiente de implementar")}logout(){this.authService.logout(),this.router.navigate(["/"])}static \u0275fac=function(n){return new(n||a)(s(D),s(E),s(z),s($),s(J))};static \u0275cmp=h({type:a,selectors:[["app-pagos-pendientes"]],decls:11,vars:4,consts:[[3,"changeInfo","logout","navLinks"],[1,"min-h-screen","bg-white"],[1,"container","mx-auto","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-4xl","font-bold","text-foreground","mb-2"],[1,"text-primary"],["class","text-center py-12",4,"ngIf"],["class","grid gap-4",4,"ngIf"],[1,"text-center","py-12"],[1,"animate-spin","text-6xl","text-primary"],[1,"mt-4","text-muted-foreground"],[1,"text-8xl","text-muted-foreground"],[1,"text-2xl","font-semibold","mt-4","mb-2"],[1,"text-muted-foreground"],[1,"grid","gap-4"],["class","bg-white hover:bg-gray-50 hover:shadow-xl transition-all cursor-pointer border border-gray-200",4,"ngFor","ngForOf"],[1,"bg-white","hover:bg-gray-50","hover:shadow-xl","transition-all","cursor-pointer","border","border-gray-200"],[1,"p-6"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-3"],[1,"text-orange-500"],[1,"text-xl","font-semibold"],[1,"text-sm","text-muted-foreground"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"flex","items-start","gap-2"],[1,"font-medium"],["class","bg-yellow-50 border-l-4 border-yellow-500 p-3 mb-4",4,"ngIf"],[1,"flex","items-center","justify-between"],[1,"bg-orange-50","px-4","py-2","rounded-lg"],[1,"text-sm","text-orange-600","font-medium"],[1,"text-3xl","font-bold","text-orange-600"],["mat-raised-button","","color","primary",1,"px-8","py-3","text-lg",3,"click"],[1,"mr-2"],[1,"bg-yellow-50","border-l-4","border-yellow-500","p-3","mb-4"],[1,"text-sm"]],template:function(n,o){n&1&&(t(0,"app-header",0),x("changeInfo",function(){return o.onChangeInfo()})("logout",function(){return o.logout()}),e(),t(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),i(5,"Pagos Pendientes"),e(),t(6,"mat-icon",5),i(7,"payment"),e()(),v(8,_e,5,0,"div",6)(9,ye,7,0,"div",6)(10,Ce,2,1,"div",7),e()()),n&2&&(m("navLinks",o.navLinks),d(8),m("ngIf",o.loading),d(),m("ngIf",!o.loading&&o.pagosPendientes.length===0),d(),m("ngIf",!o.loading&&o.pagosPendientes.length>0))},dependencies:[M,L,S,w,I,T,ee,Z,Q,X,j,ne],styles:["[_nghost-%COMP%]{display:block;min-height:calc(100vh - 64px);background-color:#fff}mat-card[_ngcontent-%COMP%]{border-radius:12px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};export{re as PagosPendientesComponent};
