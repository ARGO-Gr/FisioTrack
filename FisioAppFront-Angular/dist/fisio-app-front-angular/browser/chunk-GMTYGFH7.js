import{a as N}from"./chunk-T3SLRWRV.js";import{a as q}from"./chunk-S2THENYC.js";import{a as B}from"./chunk-X3IRCCKU.js";import{b as F,c as $,d as L,e as U,f as Y}from"./chunk-AXJP532N.js";import{Ba as i,Bb as O,C as x,Ca as t,Da as C,Ea as v,Fa as y,H as P,Ha as b,Ja as _,Jb as V,Ka as l,Lb as z,Mb as X,P as g,Q as f,Ta as n,Ua as p,Va as u,Wa as R,da as s,db as S,fb as w,g as I,ha as h,la as j,ma as k,oc as H,pa as d,pc as Z,qc as G,ta as m,tb as T,ua as E,ub as D,vb as M,zb as A}from"./chunk-OSJLVL2X.js";var J=(()=>{class a{static \u0275fac=function(o){return new(o||a)};static \u0275mod=k({type:a});static \u0275inj=P({imports:[H]})}return a})();function ee(a,r){a&1&&(i(0,"span",19)(1,"mat-icon",20),n(2,"visibility"),t(),n(3," Solo Vista "),t())}function te(a,r){a&1&&(i(0,"div",21)(1,"div",22)(2,"div",23)(3,"mat-icon",8),n(4,"refresh"),t()(),i(5,"p",24),n(6,"Cargando rutina..."),t()()())}function ie(a,r){if(a&1){let e=b();v(0),i(1,"app-card",32)(2,"app-card-content",33)(3,"mat-icon",34),n(4,"schedule"),t(),i(5,"h2",35),n(6,"Tiempo de Descanso"),t(),i(7,"p",36),n(8,"Rel\xE1jate y prep\xE1rate para el siguiente ejercicio"),t(),i(9,"div",37),n(10),t(),i(11,"div",38)(12,"app-button",39),_("click",function(){g(e);let c=l(2);return f(c.togglePausa())}),i(13,"mat-icon",6),n(14),t(),n(15),t(),i(16,"app-button",39),_("click",function(){g(e);let c=l(2);return f(c.handleSiguienteEjercicio())}),n(17," Saltar Descanso "),i(18,"mat-icon",40),n(19,"chevron_right"),t()()()()(),y()}if(a&2){let e=l(2);s(10),u("",e.tiempoRestante,"s"),s(4),p(e.isPaused?"play_arrow":"pause"),s(),u(" ",e.isPaused?"Reanudar":"Pausar"," ")}}function ne(a,r){a&1&&(i(0,"div",59)(1,"mat-icon",60),n(2,"check_circle"),t(),i(3,"span",61),n(4,"Completado"),t()())}function re(a,r){if(a&1&&(i(0,"li",62)(1,"span",63),n(2),t(),i(3,"p",64),n(4),t()()),a&2){let e=r.$implicit,o=r.index;s(2),u(" ",o+1," "),s(2),p(e)}}function ae(a,r){if(a&1){let e=b();i(0,"app-button",39),_("click",function(){g(e);let c=l(3);return f(c.handleCompletarEjercicio())}),i(1,"mat-icon",6),n(2,"check_circle"),t(),n(3," Marcar como Completado "),t()}}function oe(a,r){if(a&1){let e=b();v(0),i(1,"div",41)(2,"app-card")(3,"app-card-header")(4,"div",42)(5,"div",43)(6,"app-card-title",44),n(7),t(),i(8,"app-card-description",45),n(9),t()(),d(10,ne,5,0,"div",46),t()(),i(11,"app-card-content")(12,"div",47)(13,"div",48)(14,"mat-icon",8),n(15,"fitness_center"),t(),i(16,"div")(17,"p",49),n(18,"Repeticiones"),t(),i(19,"p",50),n(20),t()()(),i(21,"div",48)(22,"mat-icon",51),n(23,"schedule"),t(),i(24,"div")(25,"p",49),n(26,"Descanso"),t(),i(27,"p",50),n(28),t()()()(),i(29,"div",52)(30,"h3",53),n(31,"Instrucciones"),t(),i(32,"ol",54),d(33,re,5,2,"li",55),t()()()(),i(34,"div",56)(35,"app-button",57),_("click",function(){g(e);let c=l(2);return f(c.handleAnteriorEjercicio())}),i(36,"mat-icon",6),n(37,"chevron_left"),t(),n(38," Anterior "),t(),d(39,ae,4,0,"app-button",58),i(40,"app-button",57),_("click",function(){g(e);let c=l(2);return f(c.handleSiguienteEjercicio())}),n(41," Siguiente "),i(42,"mat-icon",40),n(43,"chevron_right"),t()()()(),y()}if(a&2){let e=l(2);s(7),p(e.ejercicioActivo.nombre),s(2),p(e.ejercicioActivo.descripcion),s(),m("ngIf",e.ejercicioActivo.completado),s(10),p(e.ejercicioActivo.repeticiones),s(8),u("",e.ejercicioActivo.descanso,"s"),s(5),m("ngForOf",e.ejercicioActivo.instrucciones),s(2),m("disabled",e.ejercicioActual===0),s(4),m("ngIf",!e.ejercicioActivo.completado&&!e.soloVista),s(),m("disabled",e.ejercicioActual===e.ejercicios.length-1)}}function se(a,r){a&1&&(i(0,"mat-icon",45),n(1,"check_circle"),t())}function ce(a,r){if(a&1&&(i(0,"span"),n(1),t()),a&2){let e=l().index;s(),p(e+1)}}function me(a,r){a&1&&(i(0,"span",72),n(1," Actual "),t())}function le(a,r){if(a&1){let e=b();i(0,"button",65),_("click",function(){let c=g(e).index,Q=l(2);return f(Q.selectEjercicio(c))}),i(1,"div",66)(2,"span",67),d(3,se,2,0,"mat-icon",68)(4,ce,2,1,"span",18),t(),i(5,"div",69)(6,"p",70),n(7),t(),i(8,"p",49),n(9),t()()(),d(10,me,2,0,"span",71),t()}if(a&2){let e=r.$implicit,o=r.index,c=l(2);m("ngClass",o===c.ejercicioActual?"bg-primary/10 border-2 border-primary":"bg-muted/30 hover:bg-muted/50"),s(2),m("ngClass",e.completado?"bg-secondary text-secondary-foreground":o===c.ejercicioActual?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),s(),m("ngIf",e.completado),s(),m("ngIf",!e.completado),s(3),p(e.nombre),s(2),u(" ",e.repeticiones," "),s(),m("ngIf",o===c.ejercicioActual)}}function de(a,r){if(a&1&&(v(0),i(1,"div",25)(2,"div",26)(3,"div",27)(4,"span",13),n(5),S(6,"number"),t()(),i(7,"div",28),C(8,"div",15),t()(),d(9,ie,20,3,"ng-container",18)(10,oe,44,9,"ng-container",18),i(11,"app-card",29)(12,"app-card-header")(13,"app-card-title"),n(14,"Ejercicios de la Rutina"),t()(),i(15,"app-card-content")(16,"div",30),d(17,le,11,7,"button",31),t()()()(),y()),a&2){let e=l();s(5),u("",w(6,6,e.progresoTotal,"1.0-0"),"% Completado"),s(3),E("width",e.progresoTotal,"%"),s(),m("ngIf",e.enDescanso),s(),m("ngIf",!e.enDescanso),s(7),m("ngForOf",e.ejercicios)}}function pe(a,r){if(a&1){let e=b();v(0),i(1,"div",73)(2,"app-card",74)(3,"app-card-content",33)(4,"div",75)(5,"mat-icon",76),n(6,"check_circle"),t()(),i(7,"h2",77),n(8,"\xA1Rutina Completada!"),t(),i(9,"p",78),n(10),t(),i(11,"div",79)(12,"div",80)(13,"p",81),n(14),t(),i(15,"p",49),n(16,"Ejercicios"),t()(),i(17,"div",80)(18,"p",82),n(19,"100%"),t(),i(20,"p",49),n(21,"Completado"),t()()(),i(22,"app-button",83),_("click",function(){g(e);let c=l();return f(c.handleFinalizarRutina())}),n(23," Volver al Dashboard "),t()()()(),y()}if(a&2){let e=l();s(10),u(' Excelente trabajo. Has completado todos los ejercicios de la rutina "',e.rutina.nombre,'". '),s(4),p(e.ejercicios.length)}}var K=class a{constructor(r,e,o,c){this.route=r;this.router=e;this.programaService=o;this.toastService=c}destroy$=new I;timer;ejercicioActual=0;enDescanso=!1;tiempoRestante=0;isPaused=!1;loading=!0;diaId=0;diaData=null;programaActivo=null;soloVista=!1;rutina={id:0,nombre:"",descripcion:""};ejercicios=[];ngOnInit(){window.scrollTo(0,0),this.route.queryParams.pipe(x(this.destroy$)).subscribe(r=>{this.soloVista=r.soloVista==="true"}),this.route.params.pipe(x(this.destroy$)).subscribe(r=>{this.diaId=Number(r.id),this.cargarDatosRutina()})}cargarDatosRutina(){this.loading=!0,this.programaService.obtenerProgramaActivoPaciente().pipe(x(this.destroy$)).subscribe({next:r=>{this.programaActivo=r,this.encontrarDiaEnPrograma(r),this.loading=!1},error:r=>{console.error("Error al cargar rutina:",r),this.loading=!1,this.toastService.error("Error al cargar la rutina. Por favor, intenta nuevamente."),this.router.navigate(["/paciente/rutinas"])}})}encontrarDiaEnPrograma(r){for(let e of r.semanas){let o=e.dias.find(c=>c.id===this.diaId);if(o){this.diaData=o,this.mapearDiaAVista(o,r);return}}this.toastService.error("No se encontr\xF3 el d\xEDa de rutina especificado."),this.router.navigate(["/paciente/rutinas"])}mapearDiaAVista(r,e){this.rutina={id:r.id,nombre:`${r.nombreDia} - ${e.nombre}`,descripcion:e.diagnostico},this.ejercicios=r.ejercicios.map((o,c)=>({id:o.id,nombre:o.nombre,descripcion:o.descripcion,repeticiones:`${o.repeticiones} repeticiones`,descanso:o.tiempoDescanso,instrucciones:o.instrucciones,completado:o.completado}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.timer&&clearTimeout(this.timer)}get ejercicioActivo(){return this.ejercicios[this.ejercicioActual]}get progresoTotal(){return this.ejercicios.filter(r=>r.completado).length/this.ejercicios.length*100}get todosCompletados(){return this.ejercicios.every(r=>r.completado)}ngAfterViewInit(){this.iniciarTimer()}iniciarTimer(){this.enDescanso&&this.tiempoRestante>0&&!this.isPaused&&(this.timer=setTimeout(()=>{this.tiempoRestante--,this.tiempoRestante===0&&(this.enDescanso=!1),this.iniciarTimer()},1e3))}handleCompletarEjercicio(){window.scrollTo(0,0);let r=this.ejercicios[this.ejercicioActual];this.programaService.completarEjercicio(r.id,this.diaId).pipe(x(this.destroy$)).subscribe({next:()=>{this.ejercicios[this.ejercicioActual].completado=!0,this.ejercicioActual<this.ejercicios.length-1&&(this.enDescanso=!0,this.tiempoRestante=this.ejercicioActivo.descanso,this.isPaused=!1,this.iniciarTimer())},error:e=>{console.error("\u274C [handleCompletarEjercicio] Error:",{status:e.status,statusText:e.statusText,message:e.message,error:e.error,ejercicioId:r.id,diaId:this.diaId,timestamp:new Date().toISOString()}),this.toastService.error("Error al guardar el progreso. Por favor, intenta nuevamente")}})}handleSiguienteEjercicio(){this.ejercicioActual<this.ejercicios.length-1&&(this.ejercicioActual++,this.enDescanso=!1,this.tiempoRestante=0,this.timer&&clearTimeout(this.timer))}handleAnteriorEjercicio(){this.ejercicioActual>0&&(this.ejercicioActual--,this.enDescanso=!1,this.tiempoRestante=0,this.timer&&clearTimeout(this.timer))}handleFinalizarRutina(){if(!this.todosCompletados){this.toastService.warning("Debes completar todos los ejercicios antes de finalizar la rutina.");return}this.programaService.completarDia(this.diaId).pipe(x(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/paciente/rutinas"])},error:r=>{console.error("\u274C [handleFinalizarRutina] Error:",{status:r.status,statusText:r.statusText,message:r.message,error:r.error,diaId:this.diaId,todosCompletados:this.todosCompletados,timestamp:new Date().toISOString()}),this.toastService.error("Error al finalizar la rutina. Por favor, intenta nuevamente.")}})}selectEjercicio(r){this.ejercicioActual=r,this.enDescanso=!1,this.tiempoRestante=0,this.timer&&clearTimeout(this.timer)}togglePausa(){this.isPaused=!this.isPaused,this.isPaused||this.iniciarTimer()}static \u0275fac=function(e){return new(e||a)(h(V),h(z),h(q),h(B))};static \u0275cmp=j({type:a,selectors:[["app-ejecutar-rutina"]],decls:30,vars:13,consts:[[1,"min-h-screen","bg-background","pb-12"],[1,"border-b","border-border","bg-card","sticky","top-0","z-10"],[1,"container","mx-auto","px-4","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],["routerLink","/paciente/rutinas"],["size","sm"],[1,"mr-2"],[1,"flex","items-center","gap-2"],[1,"text-primary"],[1,"text-lg","font-bold","text-foreground"],["class","px-2 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-medium",4,"ngIf"],[1,"text-xs","text-muted-foreground"],[1,"text-right","hidden","md:block"],[1,"text-sm","font-medium","text-foreground"],[1,"w-32","h-2","mt-1","bg-muted","rounded-full","overflow-hidden"],[1,"bg-primary","h-full","transition-all"],[1,"container","mx-auto","px-4","py-8","pb-12"],["class","flex items-center justify-center py-20",4,"ngIf"],[4,"ngIf"],[1,"px-2","py-1","rounded-full","bg-blue-100","text-blue-700","text-xs","font-medium"],[1,"text-xs",2,"font-size","14px","width","14px","height","14px"],[1,"flex","items-center","justify-center","py-20"],[1,"text-center"],[1,"animate-spin","mb-4","mx-auto"],[1,"text-muted-foreground"],[1,"max-w-4xl","mx-auto"],[1,"md:hidden","mb-6"],[1,"flex","items-center","justify-between","mb-2"],[1,"w-full","h-2","bg-muted","rounded-full","overflow-hidden"],[1,"mt-8","mb-8"],[1,"space-y-2"],["class","w-full flex items-center justify-between p-4 rounded-lg transition-all",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"bg-gradient-to-br","from-secondary/20","to-secondary/5","border-secondary/30"],[1,"p-12","text-center"],[1,"text-secondary","text-6xl","mx-auto","mb-6"],[1,"text-3xl","font-bold","text-foreground","mb-2"],[1,"text-muted-foreground","mb-8"],[1,"text-7xl","font-bold","text-secondary","mb-8"],[1,"flex","items-center","justify-center","gap-4","flex-wrap"],["size","lg",3,"click"],[1,"ml-2"],[1,"space-y-6"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-3xl","mb-2"],[1,"text-lg"],["class","flex items-center gap-2 px-4 py-2 rounded-full bg-secondary/20",4,"ngIf"],[1,"grid","md:grid-cols-2","gap-4","mb-6"],[1,"flex","items-center","gap-3","p-4","rounded-lg","bg-muted/50"],[1,"text-sm","text-muted-foreground"],[1,"font-semibold","text-foreground"],[1,"text-accent"],[1,"space-y-4"],[1,"text-xl","font-semibold","text-foreground"],[1,"space-y-3"],["class","flex gap-3",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","gap-4","flex-wrap"],["size","lg",3,"click","disabled"],["size","lg",3,"click",4,"ngIf"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-full","bg-secondary/20"],[1,"text-secondary"],[1,"text-sm","font-medium","text-secondary"],[1,"flex","gap-3"],[1,"flex-shrink-0","w-8","h-8","rounded-full","bg-primary/10","text-primary","font-semibold","flex","items-center","justify-center","text-sm"],[1,"text-muted-foreground","leading-relaxed","pt-1"],[1,"w-full","flex","items-center","justify-between","p-4","rounded-lg","transition-all",3,"click","ngClass"],[1,"flex","items-center","gap-3"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","font-semibold","text-sm",3,"ngClass"],["class","text-lg",4,"ngIf"],[1,"text-left"],[1,"font-medium","text-foreground"],["class","text-xs font-medium text-primary px-3 py-1 rounded-full bg-primary/20",4,"ngIf"],[1,"text-xs","font-medium","text-primary","px-3","py-1","rounded-full","bg-primary/20"],[1,"max-w-2xl","mx-auto"],[1,"bg-gradient-to-br","from-secondary/20","to-primary/10","border-secondary/30"],[1,"w-20","h-20","rounded-full","bg-secondary/20","flex","items-center","justify-center","mx-auto","mb-6"],[1,"text-secondary","text-5xl"],[1,"text-4xl","font-bold","text-foreground","mb-4"],[1,"text-lg","text-muted-foreground","mb-8","leading-relaxed"],[1,"grid","grid-cols-2","gap-4","mb-8"],[1,"p-4","rounded-lg","bg-card"],[1,"text-3xl","font-bold","text-primary","mb-1"],[1,"text-3xl","font-bold","text-accent","mb-1"],["size","lg",1,"w-full","max-w-md",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"a",4)(5,"app-button",5)(6,"mat-icon",6),n(7,"close"),t(),n(8," Salir "),t()(),i(9,"div",7)(10,"mat-icon",8),n(11,"fitness_center"),t(),i(12,"div")(13,"div",7)(14,"h1",9),n(15),t(),d(16,ee,4,0,"span",10),t(),i(17,"p",11),n(18),t()()()(),i(19,"div",3)(20,"div",12)(21,"p",13),n(22),S(23,"number"),t(),i(24,"div",14),C(25,"div",15),t()()()()(),i(26,"main",16),d(27,te,7,0,"div",17)(28,de,18,9,"ng-container",18)(29,pe,24,2,"ng-container",18),t()()),e&2&&(s(15),p(o.rutina.nombre),s(),m("ngIf",o.soloVista),s(2),R(" Ejercicio ",o.ejercicioActual+1," de ",o.ejercicios.length," "),s(4),u("",w(23,10,o.progresoTotal,"1.0-0"),"% Completado"),s(3),E("width",o.progresoTotal,"%"),s(2),m("ngIf",o.loading),s(),m("ngIf",!o.loading&&!o.todosCompletados),s(),m("ngIf",!o.loading&&o.todosCompletados))},dependencies:[O,T,D,M,A,X,G,Z,J,F,$,L,U,Y,N],styles:["[_nghost-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}app-card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .3s ease-out}app-card.mt-8[_ngcontent-%COMP%]{margin-top:2rem!important}app-card.mb-8[_ngcontent-%COMP%]{margin-bottom:2rem!important}button[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out;transition:all .2s cubic-bezier(.4,0,.2,1)}button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translate(4px)}button[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98)}.text-7xl[_ngcontent-%COMP%]{font-size:4.5rem;line-height:1}@media (max-width: 768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}mat-icon.text-2xl[_ngcontent-%COMP%]{font-size:1.5rem;width:1.5rem;height:1.5rem}mat-icon.text-5xl[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem}mat-icon.text-6xl[_ngcontent-%COMP%]{font-size:3.75rem;width:3.75rem;height:3.75rem}.bg-primary[_ngcontent-%COMP%]{transition:width .3s cubic-bezier(.4,0,.2,1)}.bg-gradient-to-br[_ngcontent-%COMP%]{background-image:linear-gradient(135deg,var(--tw-gradient-stops))}.from-secondary\\\\\\/20[_ngcontent-%COMP%]{--tw-gradient-from: rgb(var(--secondary) / .2)}.to-secondary\\\\\\/5[_ngcontent-%COMP%]{--tw-gradient-to: rgb(var(--secondary) / .05)}@media (max-width: 640px){.text-3xl[_ngcontent-%COMP%]{font-size:1.875rem}.text-4xl[_ngcontent-%COMP%]{font-size:2.25rem}.text-lg[_ngcontent-%COMP%]{font-size:1.125rem}}app-button[disabled][_ngcontent-%COMP%], button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}button[_ngcontent-%COMP%]:focus-visible, app-button[_ngcontent-%COMP%]:focus-visible{outline:2px solid hsl(var(--primary));outline-offset:2px}"]})};export{K as EjecutarRutinaComponent};
